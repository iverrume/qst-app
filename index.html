<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QSTiUM - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –∏ –æ–±—É—á–µ–Ω–∏—è</title>

    <meta name="description" content="–°–æ–∑–¥–∞–≤–∞–π—Ç–µ, –ø—Ä–æ—Ö–æ–¥–∏—Ç–µ –∏ –¥–µ–ª–∏—Ç–µ—Å—å —Ç–µ—Å—Ç–∞–º–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ .qst, .txt –∏ .pdf. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ AI-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —É—á–µ–±–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤, –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –æ—à–∏–±–∫–∏ –∏ –≥–æ—Ç–æ–≤—å—Ç–µ—Å—å –∫ —ç–∫–∑–∞–º–µ–Ω–∞–º —Å QSTiUM.">
    <meta name="keywords" content="—Ç–µ—Å—Ç—ã, qst, –æ–±—É—á–µ–Ω–∏–µ, —ç–∫–∑–∞–º–µ–Ω—ã, –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —ç–∫–∑–∞–º–µ–Ω–∞–º, —Å–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç, –æ–Ω–ª–∞–π–Ω —Ç–µ—Å—Ç, AI –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–µ—Å—Ç–æ–≤, —Ä–∞–±–æ—Ç–∞ –Ω–∞–¥ –æ—à–∏–±–∫–∞–º–∏, —à–ø–∞—Ä–≥–∞–ª–∫–∞">

    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" href="favicon.png">
    <link rel="manifest" href="manifest.json">
    <script type="module" src="https://cdn.jsdelivr.net/npm/emoji-picker-element@^1/index.js"></script>
    <style>
        #gradusButton {
            line-height: 1.3;
            padding-top: 12px;
            padding-bottom: 12px;
        }
        #gradusButton .gradus-subtitle {
            display: block;
            font-size: 0.75em;
            font-weight: normal;
            margin-top: 4px;
        }
    </style>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- KaTeX –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–æ—Ä–º—É–ª -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js"></script>
</head>

<body>

    <div id="updateNotification" class="update-notification hidden">
        <span data-lang-key="update_available_text">–î–æ—Å—Ç—É–ø–Ω–∞ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è!</span>
        <button id="updateBtn" data-lang-key="update_button_text">–û–±–Ω–æ–≤–∏—Ç—å</button>
    </div>

    <div class="app-wrapper">
        <!-- === –í–û–¢ –û–ù, –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ù–´–ô –ö–û–ù–¢–ï–ô–ù–ï–† === -->
        <div class="container">

            <!-- ========== –ò–ù–î–ò–ö–ê–¢–û–† –ù–ê–ß–ê–õ–¨–ù–û–ô –ó–ê–ì–†–£–ó–ö–ò ========== -->
            <div id="initial-loader" class="loading-placeholder">
                <div class="loading-spinner"></div>
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...</p>
            </div>
            <!-- ========== –ö–û–ù–ï–¶ –ò–ù–î–ò–ö–ê–¢–û–†–ê ========== -->

            <div class="header-controls">
                <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–µ–ø–µ—Ä—å –í–ù–ï –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å –∫–Ω–æ–ø–∫–∞–º–∏ -->
                <h1 id="appTitleHeader" data-lang-key="app_title">QSTiUM</h1>
 
                <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–Ω–æ–ø–æ–∫ -->
                <div class="header-buttons"> 
                    <button id="copyQuestionBtnQuiz" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å" aria-label="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å" class="hidden" data-lang-key="copy_question_title" data-lang-skip-content="true"><i data-lucide="copy"></i></button>
                    <div class="dropdown hidden" id="webSearchDropdown">
                        <button id="searchWebButton" title="–ù–∞–π—Ç–∏ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ" aria-label="–ù–∞–π—Ç–∏ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ" data-lang-key="search_web_title" data-lang-skip-content="true"><i data-lucide="search"></i></button>
                        <div id="searchDropdownContent" class="dropdown-content">
                            <a href="#" data-engine="google" data-lang-key="search_engine_google">Google</a>
                            <a href="#" data-engine="yandex" data-lang-key="search_engine_yandex">–Ø–Ω–¥–µ–∫—Å</a>
                            <a href="#" data-engine="perplexity" data-lang-key="search_engine_perplexity">Perplexity</a>
                        </div>
                    </div>
                    <button id="chatToggle" title="–û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç" aria-label="–û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç" data-lang-key="chat_button_title" data-lang-skip-content="true"><i data-lucide="message-circle"></i></button>
                    <button id="quickModeToggle" title="–ë—ã—Å—Ç—Ä—ã–π —Ä–µ–∂–∏–º (–ê–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥)" aria-label="–ë—ã—Å—Ç—Ä—ã–π —Ä–µ–∂–∏–º" class="hidden" data-lang-key="quick_mode_title" data-lang-skip-content="true"><i data-lucide="zap"></i></button>
                    <button id="triggerWordToggle" title="–¢—Ä–∏–≥–≥–µ—Ä-—Å–ª–æ–≤–∞" aria-label="–¢—Ä–∏–≥–≥–µ—Ä-—Å–ª–æ–≤–∞" class="hidden" data-lang-key="trigger_words_title" data-lang-skip-content="true"><i data-lucide="highlighter"></i></button>

                    <div class="dropdown" id="themeDropdownContainer">
                        <button id="themeDropdownButton" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É" aria-label="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É" data-lang-key="theme_button_title" data-lang-skip-content="true">
                            <span id="themeIcon"><i data-lucide="sun-moon"></i></span>
                        </button>
                        <div id="themeDropdownContent" class="dropdown-content theme-picker-dropdown">
                            <!-- –°—é–¥–∞ JS –≤—Å—Ç–∞–≤–∏—Ç –∏–∫–æ–Ω–∫–∏ —Ç–µ–º -->
                        </div>
                    </div>

                    <button id="languageToggle" title="–°–º–µ–Ω–∏—Ç—å —è–∑—ã–∫" aria-label="–°–º–µ–Ω–∏—Ç—å —è–∑—ã–∫" data-lang-key="language_toggle_title">–†—É—Å</button>
                    <button id="favoriteQuestionBtn" title="–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ" aria-label="–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ" class="hidden" data-lang-key="favorite_button_title" data-lang-skip-content="true"><i data-lucide="star"></i></button>
                    <div class="translate-engine-container">
                        <button id="translateQuestionBtn" title="–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤–æ–ø—Ä–æ—Å" aria-label="–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤–æ–ø—Ä–æ—Å" class="hidden" data-lang-key="translate_question_title" data-lang-skip-content="true"><i data-lucide="languages"></i></button>
                        <button id="translateEngineToggle" class="hidden" title="–í—ã–±—Ä–∞—Ç—å –¥–≤–∏–∂–æ–∫ –ø–µ—Ä–µ–≤–æ–¥–∞" aria-label="–í—ã–±—Ä–∞—Ç—å –¥–≤–∏–∂–æ–∫ –ø–µ—Ä–µ–≤–æ–¥–∞">‚ñº</button>
                        <div id="translateEngineDropdown" class="dropdown-content">
                            <a href="#" data-engine="google" data-lang-key="translate_engine_google">
                                <span class="engine-name">Google</span>
                                <span class="checkmark">‚úì</span>
                            </a>
                            <a href="#" data-engine="ai" data-lang-key="translate_engine_ai">
                                <span class="engine-name">AI (–ò–ò)</span>
                                <span class="checkmark">‚úì</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="file-upload-area" id="fileUploadArea">
                <div id="searchVerificationContainer" class="hidden">
                    <p data-lang-key="checking_access">–ü—Ä–æ–≤–µ—Ä–∫–∞...</p>
                </div>
                <div id="searchActivationContainer" class="hidden">
                    <label for="accessCodeInput" data-lang-key="activation_label">–ê–∫—Ç–∏–≤–∞—Ü–∏—è:</label>
                    <input type="text" id="accessCodeInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∫–ª—é—á..." data-lang-key="activation_placeholder">
                    <button id="activateSearchBtn" data-lang-key="activation_button">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
                <div id="searchContainer" class="hidden">
                    <label for="searchQueryInput" data-lang-key="search_in_db">–ü–æ–∏—Å–∫ –≤–æ–ø—Ä–æ—Å–∞ –≤ –±–∞–∑–µ:</label>
                    <input type="text" id="searchQueryInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —á–∞—Å—Ç—å —Ç–µ–∫—Å—Ç–∞ –≤–æ–ø—Ä–æ—Å–∞..." data-lang-key="search_placeholder">
                    <button id="searchButton" data-lang-key="find_button">–ù–∞–π—Ç–∏</button>
                </div>
                <p class="main-screen-divider" data-lang-key="or_divider"></p>

                <!-- === –ù–ê–ß–ê–õ–û –ò–ó–ú–ï–ù–ï–ù–ò–ô: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –±–ª–æ–∫ —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏ === -->
                <div id="dynamicDescriptionContainer" class="dynamic-description-container" style="text-align: center; margin-bottom: 20px; color: var(--secondary-text-color); line-height: 1.6; cursor: pointer;">
                    <!-- –≠—Ç–æ—Ç –±–ª–æ–∫ –≤–∏–¥–µ–Ω –ø–æ–∏—Å–∫–æ–≤–∏–∫–∞–º –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã–º JS -->
                    <p data-lang-key="app_description">
                        QSTiUM ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ —Ç–µ—Å—Ç–∞–º –∏ —ç–∫–∑–∞–º–µ–Ω–∞–º. –ó–∞–≥—Ä—É–∂–∞–π—Ç–µ –≥–æ—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã, —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –∏–∑ —Ç–µ–∫—Å—Ç–∞ —Å –ø–æ–º–æ—â—å—é –ò–ò, –ø—Ä–æ–≤–æ–¥–∏—Ç–µ —Ä–∞–±–æ—Ç—É –Ω–∞–¥ –æ—à–∏–±–∫–∞–º–∏ –∏ –¥–µ–ª–∏—Ç–µ—Å—å –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏ —Å –¥—Ä—É–≥–∏–º–∏.
                    </p>
                </div>
                <!-- === –ö–û–ù–ï–¶ –ò–ó–ú–ï–ù–ï–ù–ò–ô === -->



                <div class="main-actions-grid">
                    <label for="fileInput" class="custom-file-upload-btn">
                        <i data-lucide="file-up"></i>
                        <!-- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±–µ—Ä—Ç–∫–∞ div -->
                        <div class="main-action-text-wrapper">
                            <span data-lang-key="choose_file">–í—ã–±–µ—Ä–∏—Ç–µ .qst|.txt|.pdf —Ñ–∞–π–ª</span>
                        </div>
                    </label>
                    <input type="file" id="fileInput" accept=".qst,.txt,.pdf" multiple>
                    
                    <button id="parserButton">
                        <i data-lucide="lightbulb"></i>
                        <!-- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±–µ—Ä—Ç–∫–∞ div -->
                        <div class="main-action-text-wrapper">
                             <span data-lang-key="parser_button_main">–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç</span>
                        </div>
                    </button>

                    <button id="gradusButton">
                        <i data-lucide="graduation-cap"></i>
                        <!-- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±–µ—Ä—Ç–∫–∞ div -->
                        <div class="main-action-text-wrapper">
                            <span>GRADUS</span>
                        </div>
                    </button>
                </div>
                                


                <div id="savedSessionArea" class="hidden">
                    <h4 data-lang-key="continue_sessions">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å:</h4>
                    <div id="savedSessionList"></div>
                </div>
                <div id="recentFilesArea" class="hidden">
                    <h4 data-lang-key="recent_files">–ù–µ–¥–∞–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ:</h4>
                    <ul id="recentFilesList"></ul>
                </div>
            </div>

            <div id="searchResultsContainer" class="view hidden">
                <div class="search-results-header">
                    <h2 data-lang-key="search_results_title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</h2>
                    <button id="backToSearchButton" class="btn btn-secondary" data-lang-key="back_to_search">–ù–æ–≤—ã–π –ø–æ–∏—Å–∫</button>
                </div>
                <div id="searchNavigation" class="search-navigation hidden">
                    <button id="prevResultBtn" class="nav-arrow" disabled>&lt;</button>
                    <span id="resultCounter">0 / 0</span>
                    <button id="nextResultBtn" class="nav-arrow" disabled>&gt;</button>
                </div>
                <div id="searchResultCards">
                    <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –±—É–¥—É—Ç –≤—Å—Ç–∞–≤–ª—è—Ç—å—Å—è —Å—é–¥–∞ -->
                </div>
            </div>

            <div id="gradusFoldersContainer" class="hidden">
                <h2 data-lang-key="nav_gradus">–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ GRADUS</h2>
                <div id="gradusBreadcrumbs"></div>
                <div id="gradusFolderList"></div>
                <button id="backToFileUploadButton" style="margin-top: 15px;" data-lang-key="back_to_main">–ù–∞–∑–∞–¥ –∫ –≥–ª–∞–≤–Ω–æ–º—É —ç–∫—Ä–∞–Ω—É</button>
            </div>

            <div id="quizSetupArea" class="hidden">
                <h2 data-lang-key="quiz_settings_title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–∞</h2>

                <div class="settings-group">
                    <label for="timeLimitSlider" data-lang-key="time_limit">–õ–∏–º–∏—Ç –≤—Ä–µ–º–µ–Ω–∏ (–º–∏–Ω—É—Ç—ã, 0 - –±–µ–∑ –ª–∏–º–∏—Ç–∞):</label>
                    <div class="time-limit-wrapper">
                        <!-- –ü–æ–ª–µ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞ -->
                        <div class="range-inputs-container time-limit-input-container">
                             <input type="number" id="timeLimitInput" min="0" max="180" value="0" class="range-input">
                             <span data-lang-key="time_limit_minutes">–º–∏–Ω</span>
                        </div>
                        <!-- –£–ª—É—á—à–µ–Ω–Ω—ã–π —Å–ª–∞–π–¥–µ—Ä —Å –ø–æ–¥—Å–∫–∞–∑–∫–æ–π -->
                        <div class="single-slider-container time-slider-modern">
                            <div id="timeSliderValueBubble" class="slider-value-bubble">0 –º–∏–Ω</div>
                            <div id="timeSliderTrack" class="slider-track"></div>
                            <div id="timeSliderTicks" class="slider-ticks"></div>
                            <div id="timeSliderProgress" class="slider-progress"></div>
                            <input type="range" id="timeLimitSlider" min="0" max="180" value="0" step="1">
                        </div>
                    </div>
                </div>


                <div class="settings-group" id="questionRangeGroup">
                    <div class="range-label-container">
                        <label for="questionRangeStart" data-lang-key="question_range">–î–∏–∞–ø–∞–∑–æ–Ω –≤–æ–ø—Ä–æ—Å–æ–≤:</label>
                        <span id="maxQuestionsInfo"></span>
                    </div>
                    <div class="dual-slider-container">
                        <div id="sliderTrack" class="slider-track"></div>
                        <div id="sliderTicks" class="slider-ticks"></div>
                        <div id="sliderProgress" class="slider-progress"></div>
                        <input type="range" id="rangeSliderStart" min="1" value="1" step="1">
                        <input type="range" id="rangeSliderEnd" min="1" value="100" step="1">
                    </div>
                    <div class="range-inputs-container">
                        <span data-lang-key="range_from">–û—Ç</span> 
                        <input type="number" id="questionRangeStart" min="1" value="1" class="range-input">
                        <span data-lang-key="range_to">–î–æ</span> 
                        <input type="number" id="questionRangeEnd" min="1" class="range-input">
                    </div>
                </div>




                <div class="settings-group">
                    <input type="checkbox" id="shuffleNQuestions">
                    <label for="shuffleNQuestions" data-lang-key="shuffle_n_questions">–°–ª—É—á–∞–π–Ω—ã–π –Ω–∞–±–æ—Ä –∏–∑</label>
                    <input type="number" id="shuffleNQuestionsCount" min="1" value="50" class="range-input" style="width: 70px;">
                    <label for="shuffleNQuestionsCount" data-lang-key="questions_label_for_range">–≤–æ–ø—Ä–æ—Å–æ–≤</label>
                </div>

                <!-- ======== –ù–ê–ß–ê–õ–û –ù–û–í–û–ì–û –ö–û–î–ê ======== -->
                <div class="settings-group hidden" id="languageFilterGroup">
                    <label for="languageFilter" data-lang-key="language_filter_label">–Ø–∑—ã–∫ –≤–æ–ø—Ä–æ—Å–æ–≤:</label>
                    <select id="languageFilter" style="width: 100%; padding: 8px; border-radius: 4px; margin-top: 10px;">
                        <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                    </select>
                </div>
                <!-- ======== –ö–û–ù–ï–¶ –ù–û–í–û–ì–û –ö–û–î–ê ======== -->

                <!-- ======== –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê –§–ò–õ–¨–¢–†–ê –ö–ê–¢–ï–ì–û–†–ò–ô ======== -->
                <div class="settings-group hidden" id="categoryFilterGroup">
                    <div class="category-filter-header">
                        <label data-lang-key="category_filter_label">–§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:</label>
                        <div>
                            <button id="selectAllCategoriesBtn" class="btn-secondary-small" data-lang-key="select_all_btn">–í—Å–µ</button>
                            <button id="deselectAllCategoriesBtn" class="btn-secondary-small" data-lang-key="deselect_all_btn">–°–Ω—è—Ç—å</button>
                        </div>
                    </div>
                    <div id="categoryCheckboxes" class="category-checkboxes-container">
                        <!-- –ß–µ–∫–±–æ–∫—Å—ã —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –±—É–¥—É—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω—ã —Å—é–¥–∞ —á–µ—Ä–µ–∑ JS -->
                    </div>
                    <p class="category-filter-note" data-lang-key="category_filter_note">
                        –ï—Å–ª–∏ –Ω–∏ –æ–¥–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –≤—ã–±—Ä–∞–Ω–∞, –≤ —Ç–µ—Å—Ç –≤–æ–π–¥—É—Ç –≤–æ–ø—Ä–æ—Å—ã –∏–∑ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π.
                    </p>
                </div>
                <!-- ======== –ö–û–ù–ï–¶ –ë–õ–û–ö–ê –§–ò–õ–¨–¢–†–ê –ö–ê–¢–ï–ì–û–†–ò–ô ======== -->

                <div class="settings-group">
                    <input type="checkbox" id="shuffleQuestions">
                    <label for="shuffleQuestions" data-lang-key="shuffle_questions">–ü–µ—Ä–µ–º–µ—à–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã</label>
                </div>



                <div class="settings-group">
                    <input type="checkbox" id="shuffleAnswers">
                    <label for="shuffleAnswers" data-lang-key="shuffle_answers">–ü–µ—Ä–µ–º–µ—à–∞—Ç—å –æ—Ç–≤–µ—Ç—ã</label>
                </div>
                <div class="settings-group">
                    <input type="checkbox" id="feedbackMode">
                    <label for="feedbackMode" data-lang-key="feedback_mode">–†–µ–∂–∏–º –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—à–∏–±–∫–∏)</label>
                </div>
                <div class="settings-group">
                    <input type="checkbox" id="readingMode">
                    <label for="readingMode" data-lang-key="reading_mode">–†–µ–∂–∏–º —á—Ç–µ–Ω–∏—è (–ø–µ—Ä–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –≤–µ—Ä–Ω—ã–π)</label>
                </div>
                <div class="settings-group">
                    <input type="checkbox" id="flashcardsMode">
                    <label for="flashcardsMode" data-lang-key="flashcards_mode">–†–µ–∂–∏–º –∫–∞—Ä—Ç–æ—á–µ–∫ (–≤–æ–ø—Ä–æ—Å/–æ—Ç–≤–µ—Ç)</label>
                </div>
                <button id="startQuizButton" data-lang-key="start_quiz_button">–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç</button>
                <button id="generateCheatSheetButton" style="margin-top: 10px;" data-lang-key="generate_cheat_sheet_button">–°–æ–∑–¥–∞—Ç—å —à–ø–æ—Ä—É</button>
                <button id="chooseAnotherFileButton" style="margin-top: 10px;" data-lang-key="choose_another_file_button">–í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π —Ñ–∞–π–ª</button>
            </div>

            <div id="cheatSheetResultArea" class="hidden">
                <h2 data-lang-key="cheat_sheet_title">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–ø–æ—Ä–∞:</h2>
                <textarea id="cheatSheetOutput" readonly rows="15"></textarea>
                <button id="downloadCheatSheetButton" data-lang-key="download_cheat_sheet_button">–°–∫–∞—á–∞—Ç—å —à–ø–æ—Ä—É (.txt)</button>
                <button id="backToSettingsButton" style="margin-top: 10px;" data-lang-key="back_to_settings_button">–ù–∞–∑–∞–¥ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º</button>
            </div>

            <div id="quizArea" class="hidden">
                <div id="timerDisplay" class="hidden"><span data-lang-key="timer_label">–í—Ä–µ–º—è:</span> <span id="timeLeft">--:--</span></div>
                <div id="questionContainer">
                    <div id="questionText"></div>
                    <ul id="answerOptions"></ul>
                    <div id="feedbackArea" class="feedback-area"></div>
                </div>
                <div id="questionNavigationControls">
                    <button id="prevQuestionButton" disabled data-lang-key="prev_question_button">–ü—Ä–µ–¥—ã–¥—É—â–∏–π</button>
                    <button id="nextButton" data-lang-key="next_question_button">–°–ª–µ–¥—É—é—â–∏–π</button>
                </div>
                <div id="score">
                    <p><span data-lang-key="question_label">–í–æ–ø—Ä–æ—Å:</span> <span id="currentQuestionNum">0</span> / <span id="totalQuestionsNum">0</span></p>
                    <p><span data-lang-key="correct_label">–ü—Ä–∞–≤–∏–ª—å–Ω–æ:</span> <span id="correctAnswersCount">0</span></p>
                </div>
                <div id="quickNavPanel" class="hidden">
                    <h4 data-lang-key="quick_nav_title">–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º:</h4>
                    <div id="quickNavButtons"></div>
                </div>
                <div class="quiz-footer-controls">
                     <button id="downloadTranslatedTxtButton" class="hidden">–°–∫–∞—á–∞—Ç—å (txt)</button>
                     <button id="downloadTranslatedQstButton" class="hidden">–°–∫–∞—á–∞—Ç—å (qst)</button>
                     <button id="continueLaterButton" class="hidden" data-lang-key="continue_later_button">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–∑–∂–µ</button>
                     <button id="finishTestButton" class="finish-test-early hidden" data-lang-key="finish_early_button">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç</button>
                </div>
            </div>

            <div id="resultsArea" class="hidden">
                <h2 data-lang-key="quiz_finished_title">–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!</h2>
                <p><span data-lang-key="your_result">–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</span> <span id="finalCorrect"></span> <span data-lang-key="of_label">–∏–∑</span> <span id="finalTotal"></span>.</p>
                <p><span data-lang-key="accuracy_label">–¢–æ—á–Ω–æ—Å—Ç—å:</span> <span id="finalPercentage"></span>%</p>
                <div id="feedbackDownloadArea" class="hidden">
                    <button id="downloadErrorsButton" data-lang-key="download_errors_button">–°–∫–∞—á–∞—Ç—å –Ω–µ–æ—Ç–≤–µ—á–µ–Ω–Ω—ã–µ/–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã</button>
                </div>
                <div id="errorReviewArea" class="hidden">
                     <button id="reviewErrorsButton" data-lang-key="review_errors_button">–†–∞–±–æ—Ç–∞ –Ω–∞–¥ –æ—à–∏–±–∫–∞–º–∏</button>
                </div>
                <div id="aiAnalysisArea" class="hidden">
                    <button id="aiAnalysisBtn" data-lang-key="ai_error_analysis_button">ü§ñ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫ –æ—Ç –ò–ò</button>
                    <div id="aiAnalysisResult" class="ai-analysis-result hidden">
                        <!-- –°—é–¥–∞ –±—É–¥–µ—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞ -->
                    </div>
                </div>
                <div id="triggeredQuizDownloadArea" class="hidden">
                    <button id="downloadTriggeredQuizButton" data-lang-key="download_triggered_quiz_button">–°–∫–∞—á–∞—Ç—å —Ç–µ—Å—Ç —Å —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏</button>
                </div>
                <button id="restartButton" data-lang-key="restart_button">–ü—Ä–æ–π—Ç–∏ –¥—Ä—É–≥–æ–π —Ç–µ—Å—Ç</button>
            </div>

            <div id="parserArea" class="hidden">
                <div class="parser-tabs">
                    <button id="converterTabBtn" class="parser-tab active" data-lang-key="tab_converter">–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –∏–∑ —Ç–µ–∫—Å—Ç–∞</button>
                    <button id="aiFromTextTabBtn" class="parser-tab" data-lang-key="tab_ai_from_text">–ò–ò-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–∑ —Ç–µ–∫—Å—Ç–∞</button>
                    <button id="aiFromTopicTabBtn" class="parser-tab" data-lang-key="tab_ai_generator">–ò–ò-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–æ —Ç–µ–º–µ</button>
                </div>
                <div class="parser-tab-content-wrapper">
                    <!-- === –í–ö–õ–ê–î–ö–ê 1: –ö–û–ù–í–ï–†–¢–ï–† === -->
                    <div id="converterContent" class="parser-tab-content active">
                        <p style="text-align: center; color: var(--secondary-text-color);" data-lang-key="parser_description">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –∏–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç...</p>
                        <div class="settings-group">
                            <div class="parser-label-container">
                                <label for="parserFileInput" data-lang-key="parser_upload_or_paste">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª (.txt) –∏–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –Ω–∏–∂–µ:</label>
                                <button id="clearParserInputBtn" class="btn-secondary-small" data-lang-key="clear_parser_input">–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª–µ</button>
                            </div>
                            <input type="file" id="parserFileInput" accept=".txt,.pdf" multiple>
                            <textarea id="parserInput" rows="10" placeholder="–ò–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ —Ç–µ–∫—Å—Ç –∏–∑ –≤–∞—à–µ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞..." data-lang-key="parser_input_placeholder"></textarea>
                        </div>
                        <div class="settings-group">
                            <label for="parserPatternSelect" data-lang-key="parser_select_format">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç (–∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –¥–ª—è –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è):</label>
                            <select id="parserPatternSelect" style="width: 100%; padding: 8px; border-radius: 4px;">
                                <option value="auto" selected data-lang-key="parser_auto_detect">-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ --</option>
                            </select>
                        </div>
                        <div class="settings-group" style="text-align: center;">
                            <button id="runParserBtn" data-lang-key="parser_run_button">–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        </div>
                        <div id="converterOutputArea" class="hidden">
                            <hr>
                            <div class="parser-output-header">
                                <h3 data-lang-key="parser_result_title">–†–µ–∑—É–ª—å—Ç–∞—Ç:</h3>
                                <div style="display: flex; gap: 10px;">
                                     <button id="filterVariantsBtn" data-lang-key="filter_variants_button">‚öôÔ∏è –§–∏–ª—å—Ç—Ä –ø–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º</button>
                                     <button id="clearConverterOutputBtn" class="btn-secondary-small" data-lang-key="clear_parser_input">–û—á–∏—Å—Ç–∏—Ç—å</button>
                                </div>
                            </div>
                            <div id="filterVariantsDropdown" class="filter-dropdown hidden">
                                <div class="filter-dropdown-header" data-lang-key="filter_variants_header">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª-–≤–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:</div>
                                <div id="filterVariantCheckboxes" class="filter-checkboxes">
                                    <!-- –ß–µ–∫–±–æ–∫—Å—ã –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã JavaScript -->
                                </div>
                                <div class="filter-actions">
                                    <button id="resetVariantFilterBtn" class="btn-secondary-small" data-lang-key="filter_reset_button">–°–±—Ä–æ—Å</button>
                                    <button id="applyVariantFilterBtn" data-lang-key="filter_apply_button">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                                </div>
                            </div>
                            <div class="parser-result-wrapper">
                                <div class="result-column">
                                    <textarea id="converterOutput" rows="15"></textarea>
                                </div>
                                <div id="converterErrorsArea" class="errors-column hidden">
                                    <div id="converterErrorsHeader" class="errors-header">
                                        <span><span data-lang-key="parser_errors_found">‚ö†Ô∏è –û—à–∏–±–∫–∏</span> (<span id="converterErrorCount">0</span>)</span>
                                    </div>
                                    <ul id="converterErrorList"></ul>
                                </div>
                            </div>
                            <button id="downloadConverterBtn" data-lang-key="download_parsed_button">–°–∫–∞—á–∞—Ç—å .qst —Ñ–∞–π–ª</button>
                        </div>
                    </div>

                    <!-- === –í–ö–õ–ê–î–ö–ê 2: –ò–ò-–ì–ï–ù–ï–†–ê–¢–û–† –ò–ó –¢–ï–ö–°–¢–ê === -->
                    <div id="aiFromTextContent" class="parser-tab-content">
                        <p style="text-align: center; color: var(--secondary-text-color);" data-lang-key="ai_from_text_description">–í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç, –∏ –ò–ò —Å–æ–∑–¥–∞—Å—Ç –ø–æ –Ω–µ–º—É —Ç–µ—Å—Ç.</p>
                        <div class="settings-group">
                            <div class="parser-label-container">
                                <label for="aiParserFileInput" data-lang-key="parser_upload_or_paste">1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª (.txt) –∏–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –Ω–∏–∂–µ:</label>
                                <button id="clearAiParserInputBtn" class="btn-secondary-small" data-lang-key="clear_parser_input">–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª–µ</button>
                            </div>
                            <input type="file" id="aiParserFileInput" accept=".txt">
                            <textarea id="aiParserInput" rows="10" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ —Ç–µ–∫—Å—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ò–ò..." data-lang-key="ai_parser_input_placeholder"></textarea>
                        </div>
                        <div class="settings-group">
                            <label for="aiQuestionCount" data-lang-key="ai_question_count_label">2. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –ò–ò:</label>
                            <div style="display: flex; gap: 10px; align-items: center; margin-top: 10px;">
                                <input type="number" id="aiQuestionCount" min="1" value="5" class="range-input" style="width: 80px;">
                                <input type="checkbox" id="aiAutoCount" style="margin-left: 15px;">
                                <label for="aiAutoCount" data-lang-key="ai_auto_mode_label">–ê–≤—Ç–æ</label>
                            </div>
                        </div>
                        <div class="settings-group">
                            <label for="aiAnswerCount" data-lang-key="ai_answer_count_label">3. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞:</label>
                            <select id="aiAnswerCount" style="width: 100%; padding: 8px; border-radius: 4px; margin-top: 10px;">
                                <option value="3">3</option>
                                <option value="4" selected><span data-lang-key="ai_option_default">4 (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)</span></option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                            </select>
                        </div>
                        <div class="settings-group">
                             <div style="display: flex; gap: 10px; align-items: center; margin-top: 10px;">
                                <input type="checkbox" id="aiAutoCategory" checked>
                                <label for="aiAutoCategory" data-lang-key="ai_auto_category_label">4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</label>
                            </div>
                        </div>
                        <div class="settings-group" style="text-align: center;">
                            <button id="generateTestFromTextBtn"><span data-lang-key="ai_generate_from_text_button">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç –∏–∑ —Ç–µ–∫—Å—Ç–∞</span></button>
                        </div>
                        <div id="aiFromTextOutputArea" class="hidden">
                            <hr>
                            <div class="parser-output-header">
                                <h3 data-lang-key="parser_result_title">–†–µ–∑—É–ª—å—Ç–∞—Ç:</h3>
                                <button id="clearAiFromTextOutputBtn" class="btn-secondary-small" data-lang-key="clear_parser_input">–û—á–∏—Å—Ç–∏—Ç—å</button>
                            </div>
                            <textarea id="aiFromTextOutput" rows="10"></textarea>
                            <button id="downloadAiFromTextBtn" data-lang-key="download_parsed_button">–°–∫–∞—á–∞—Ç—å .qst —Ñ–∞–π–ª</button>
                        </div>
                    </div>

                    <!-- === –í–ö–õ–ê–î–ö–ê 3: –ò–ò-–ì–ï–ù–ï–†–ê–¢–û–† –ü–û –¢–ï–ú–ï === -->
                    <div id="aiGeneratorContent" class="parser-tab-content">
                        <p style="text-align: center; color: var(--secondary-text-color);" data-lang-key="ai_topic_description">–ò–ò —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Å–æ–∑–¥–∞—Å—Ç —Ç–µ—Å—Ç...</p>
                        <div class="settings-group">
                             <label for="aiTopicInput" data-lang-key="ai_topic_label">–í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–∞:</label>
                             <textarea id="aiTopicInput" rows="4" placeholder="–ü—Ä–∏–º–µ—Ä: –ò—Å—Ç–æ—Ä–∏—è –î—Ä–µ–≤–Ω–µ–≥–æ –†–∏–º–∞..." data-lang-key="ai_topic_placeholder"></textarea>
                        </div>
                        <div class="settings-group">
                            <label for="aiTopicQuestionCount" data-lang-key="ai_topic_question_count_label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤ (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ –≤ —Ç–µ–º–µ):</label>
                            <input type="number" id="aiTopicQuestionCount" min="1" max="50" value="10" class="range-input" style="width: 80px; margin-top: 10px;">
                        </div>
                        <div class="settings-group">
                            <label for="aiTopicAnswerCount" data-lang-key="ai_topic_answer_count_label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞ (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ –≤ —Ç–µ–º–µ):</label>
                            <select id="aiTopicAnswerCount" style="width: 100%; padding: 8px; border-radius: 4px; margin-top: 10px;">
                                <option value="3">3</option>
                                <option value="4" selected><span data-lang-key="ai_option_default">4 (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)</span></option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                            </select>
                        </div>
                        <div class="settings-group">
                             <div style="display: flex; gap: 10px; align-items: center; margin-top: 10px;">
                                <input type="checkbox" id="aiTopicAutoCategory" checked>
                                <label for="aiTopicAutoCategory" data-lang-key="ai_topic_auto_category_label">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</label>
                            </div>
                        </div>
                        <div class="settings-group" style="text-align: center;">
                            <button id="generateTestFromTopicBtn"><span data-lang-key="ai_generate_from_topic_button">ü§ñ –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç –ø–æ —Ç–µ–º–µ (–ò–ò)</span></button>
                        </div>
                        <div id="aiFromTopicOutputArea" class="hidden">
                            <hr>
                            <div class="parser-output-header">
                                <h3 data-lang-key="parser_result_title">–†–µ–∑—É–ª—å—Ç–∞—Ç:</h3>
                                <button id="clearAiFromTopicOutputBtn" class="btn-secondary-small" data-lang-key="clear_parser_input">–û—á–∏—Å—Ç–∏—Ç—å</button>
                            </div>
                            <textarea id="aiFromTopicOutput" rows="10"></textarea>
                            <button id="downloadAiFromTopicBtn" data-lang-key="download_parsed_button">–°–∫–∞—á–∞—Ç—å .qst —Ñ–∞–π–ª</button>
                        </div>
                    </div>
                </div>
                <div id="parserErrorsArea" class="hidden">
                </div>
                <div id="parserOutputArea" class="hidden">
                </div>
                <button id="backToMainFromParserBtn" style="margin-top: 15px; background-color: var(--button-secondary-bg);" data-lang-key="back_button">–ù–∞–∑–∞–¥</button>
            </div>
        </div> 

        <!-- ========== –®–ê–ë–õ–û–ù–´ –î–õ–Ø –î–ò–ù–ê–ú–ò–ß–ï–°–ö–û–ì–û –ö–û–ù–¢–ï–ù–¢–ê ========== -->
        <template id="searchResultCardTemplate">
            <div class="result-card">
                <div class="result-card-header">
                    <div class="result-card-actions">
                        <button class="explain-search-result-btn" title="–û–±—ä—è—Å–Ω–∏—Ç—å —Å –ø–æ–º–æ—â—å—é –ò–ò"><i data-lucide="brain-circuit"></i></button>
                        <button class="copy-search-result-btn" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å"><i data-lucide="copy"></i></button>
                        <button class="favorite-search-result-btn" title="–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ"><i data-lucide="star"></i></button>
                        <button class="translate-search-result-btn" title="–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤–æ–ø—Ä–æ—Å"><i data-lucide="languages"></i></button>
                    </div>
                </div>
                <div class="result-card-content">
                    <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–æ–ø—Ä–æ—Å–∞ –∏ –æ—Ç–≤–µ—Ç–æ–≤ –±—É–¥–µ—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω–æ —Å—é–¥–∞ -->
                </div>
            </div>
        </template>
        <template id="messageTemplate">
            <div class="message">
                <div class="message-header">
                    <span class="author"></span>
                    <span class="timestamp"></span>
                </div>
                <div class="reply-context-container"></div>
                <div class="message-main-content"></div>
                <div class="reactions-container"></div>
                <div class="message-actions-toolbar"></div>
            </div>
        </template>
        <template id="savedSessionCardTemplate">
            <div class="saved-session-card">
                <div class="saved-session-name"></div>
                <div class="saved-session-progress-info">
                    <span class="progress-label"></span>
                    <div class="saved-session-time"></div>
                </div>
                <div class="progress-bar">
                    <div class="progress-bar-fill"></div>
                </div>
                <div class="saved-session-actions">
                    <button class="btn-resume"></button>
                    <button class="btn-delete"></button>
                </div>
            </div>
        </template>
        <!-- ========== –ö–û–ù–ï–¶ –®–ê–ë–õ–û–ù–û–í ========== -->
        
        <footer>
            <p>
                <a href="https://chromewebstore.google.com/detail/qstium-helper/ekamfcpbkcekmmbclpnlmhcimnenabcl?hl=ru&utm_source=ext_sidebar" target="_blank" rel="noopener noreferrer" data-lang-key="footer_copyright">prod by @iverrum</a>
            </p>
        </footer>

        <!-- ======================================================= -->
        <!-- ===      –ù–û–í–ê–Ø –ö–ù–û–ü–ö–ê (FAB) –î–õ–Ø AI-–ß–ê–¢–ê             === -->
        <!-- ======================================================= -->
        <button id="aiChatFab" class="ai-chat-fab" title="AI –ü–æ–º–æ—â–Ω–∏–∫" data-lang-key="ai_fab_title" data-lang-skip-content="true">
            <i data-lucide="bot"></i>
        </button>

            <!-- ======================================================= -->
            <!-- ===    –ù–û–í–û–ï –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø AI-–ß–ê–¢–ê             === -->
            <!-- ======================================================= -->
            <div id="aiChatModal" class="modal-overlay hidden">
                <div class="modal-content ai-chat-modal-content">

                    <div class="ai-chat-header">
                        <h3><i data-lucide="brain-circuit"></i> <span data-lang-key="ai_chat_title"></span></h3>

                        <div id="aiColorLegendsWithEditor" class="ai-color-legend-container hidden">


                            <div id="aiColorLegendsWithList" class="ai-color-legend-list">
                                <!-- –°—é–¥–∞ JS –±—É–¥–µ—Ç –≤—Å—Ç–∞–≤–ª—è—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –ª–µ–≥–µ–Ω–¥—ã -->
                            </div>
                            <div id="aiColorLegendEditor" class="ai-color-legend-editor hidden">
                                <div class="legend-editor-header">
                                    <span id="aiLegendEditorColor" class="legend-color-swatch"></span>
                                    <input type="text" id="aiLegendTextInput" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è —Ü–≤–µ—Ç–∞..." data-lang-key="ai_legend_editor_placeholder">
                                </div>
                                <div class="legend-editor-actions">
                                    <button id="aiLegendCancelBtn" class="btn-secondary-small" data-lang-key="modal_cancel_button">–û—Ç–º–µ–Ω–∞</button>
                                    <button id="aiLegendSaveBtn" data-lang-key="modal_save_button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                                </div>
                            </div>
                        </div>


                        <!-- –ù–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–æ–∫ -->
                        <div class="ai-chat-header-controls">
                            <button id="aiChatSettingsBtn" class="ai-chat-control-btn" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ò–ò" data-lang-key="ai_settings_title" data-lang-skip-content="true"><i data-lucide="sliders-horizontal"></i></button>
                            <button id="aiChatResizeBtn" class="ai-chat-control-btn" title="–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å / –°–≤–µ—Ä–Ω—É—Ç—å" data-lang-key="ai_resize_title" data-lang-skip-content="true"><i data-lucide="maximize-2"></i></button>
                            <button id="aiChatCloseBtn" class="ai-chat-control-btn" title="–ó–∞–∫—Ä—ã—Ç—å" data-lang-key="ai_close_chat_title" data-lang-skip-content="true"><i data-lucide="x"></i></button>
                        </div>


                    </div> <!-- –ó–∞–∫—Ä—ã–≤–∞—é—â–∏–π </div> –¥–ª—è .ai-chat-header -->



                    <!-- ======== –ù–ê–ß–ê–õ–û –ù–û–í–û–ô –ü–ê–ù–ï–õ–ò –ù–ê–°–¢–†–û–ï–ö ======== -->
                    <div id="aiChatSettingsPanel" class="ai-chat-settings-panel hidden">

                        <div class="ai-setting-group">
                            <label for="aiModelSelectContainer" data-lang-key="ai_model_label">–ú–æ–¥–µ–ª—å –ò–ò</label>
                            <div class="ai-custom-select" id="aiModelSelectContainer">
                                <button class="ai-select-button">
                                    <span id="aiModelSelectText">Flash (—Å–∞–º–∞—è —É–º–Ω–∞—è –∏ –±—ã—Å—Ç—Ä–∞—è)</span>
                                    <i data-lucide="chevron-down"></i>
                                </button>
                                <div class="ai-select-dropdown hidden">
                                    <a href="#" data-value="gemini-2.5-flash-lite" data-lang-key="ai_model_flash">Flash 2.5 (—Å–∞–º–∞—è —É–º–Ω–∞—è)</a>
                                    <a href="#" data-value="gemma-3-27b-it" data-lang-key="ai_model_gemma_27b">Gemma 3.27b (—É–º–Ω–∞—è)</a>
                                    <a href="#" data-value="gemma-3-12b-it" data-lang-key="ai_model_gemma_12b">Gemma 3.12b (–±–∞–ª–∞–Ω—Å)</a>
                                </div>
                            </div>
                        </div>
                        <div class="ai-setting-group">
                            <label for="aiResponseLengthSelectContainer" data-lang-key="ai_response_style_label">–°—Ç–∏–ª—å –æ—Ç–≤–µ—Ç–∞</label>
                            <div class="ai-custom-select" id="aiResponseLengthSelectContainer">
                                <button class="ai-select-button">
                                    <span id="aiResponseLengthSelectText">–û–±—ã—á–Ω—ã–π</span>
                                    <i data-lucide="chevron-down"></i>
                                </button>
                                <div class="ai-select-dropdown hidden">
                                    <a href="#" data-value="short" data-lang-key="ai_response_short">–ö–æ—Ä–æ—Ç–∫–∏–π</a>
                                    <a href="#" data-value="medium" data-lang-key="ai_response_medium">–û–±—ã—á–Ω—ã–π</a>
                                    <a href="#" data-value="long" data-lang-key="ai_response_long">–†–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π</a>
                                </div>
                            </div>
                        </div>

                        <div class="ai-setting-group">
                            <label for="aiCreativitySlider" data-lang-key="ai_creativity_label">–ö—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å</label>
                            <span id="aiCreativityValue" data-creativity-key="medium">–°—Ä–µ–¥–Ω—è—è</span>
                        </div>
                        <input type="range" id="aiCreativitySlider" min="0" max="2" value="1" step="1">
                        
                    </div>

                    <div class="ai-chat-body-wrapper">  

                        <div id="aiChatSidebar" class="ai-chat-sidebar">




                            <!-- === –í–ï–†–•–ù–Ø–Ø –°–ï–ö–¶–ò–Ø: –ü–†–ò–í–ê–¢–ù–´–ï –ß–ê–¢–´ === -->
                            <div class="ai-sidebar-section" id="aiPrivateChatsSection">
                                <div class="ai-sidebar-section-header">
                                    <h4><i data-lucide="lock"></i> <span data-lang-key="ai_private_chats">–ü—Ä–∏–≤–∞—Ç–Ω—ã–µ —á–∞—Ç—ã</span></h4>
                                    <button id="aiNewPrivateChatBtn" class="ai-sidebar-action-btn" title="–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —á–∞—Ç" data-lang-key="ai_new_private_chat_title" data-lang-skip-content="true">
                                        <i data-lucide="plus"></i>
                                    </button>
                                </div>
                                <ul id="aiChatHistoryList" class="ai-chat-history-list">
                                    <!-- –°—é–¥–∞ JS –¥–æ–±–∞–≤–∏—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —á–∞—Ç—ã -->
                                </ul>
                            </div>




                            <!-- === –†–ê–ó–î–ï–õ–ò–¢–ï–õ–¨ === -->
                            <div class="ai-sidebar-divider"></div>




                            <!-- === –ù–ò–ñ–ù–Ø–Ø –°–ï–ö–¶–ò–Ø: –ü–£–ë–õ–ò–ß–ù–´–ï –ê–£–î–ò–¢–û–†–ò–ò === -->
                            <div class="ai-sidebar-section" id="aiPublicAudiencesSection">
                                <div class="ai-sidebar-section-header">
                                    <h4><i data-lucide="users"></i> <span data-lang-key="ai_audiences">–ê—É–¥–∏—Ç–æ—Ä–∏–∏</span></h4>
                                    <button id="aiNewAudienceBtn" class="ai-sidebar-action-btn" title="–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –ê—É–¥–∏—Ç–æ—Ä–∏—é (–≤–∏–¥–Ω–∞ –≤—Å–µ–º)" data-lang-key="ai_new_audience_title" data-lang-skip-content="true">
                                        <i data-lucide="plus"></i>
                                    </button>
                                </div>


                                <ul id="aiAudiencesList" class="ai-chat-history-list">
                                     <!-- –°—é–¥–∞ JS –¥–æ–±–∞–≤–∏—Ç –ø—É–±–ª–∏—á–Ω—ã–µ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ -->
                                </ul>
                            </div>

                            <!-- === –ù–û–í–´–ô –ë–õ–û–ö: –≠–ö–†–ê–ù –ü–†–û–°–ú–û–¢–†–ê –¢–ï–ú –í–ù–£–¢–†–ò –ê–£–î–ò–¢–û–†–ò–ò === -->
                            <div class="ai-sidebar-section hidden" id="aiTopicsView">


                                <div class="ai-sidebar-section-header">
                                    <button id="aiBackToAudiencesBtn" class="ai-sidebar-action-btn" title="–ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É –ê—É–¥–∏—Ç–æ—Ä–∏–π" data-lang-key="ai_back_to_audiences_title" data-lang-skip-content="true">
                                        <i data-lucide="arrow-left"></i>
                                    </button>
                                    <div id="aiTopicsBreadcrumb" class="ai-topics-breadcrumb"></div>
                                    <button id="aiNewTopicBtn" class="ai-sidebar-action-btn" title="–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –¢–µ–º—É –≤ —ç—Ç–æ–π –ê—É–¥–∏—Ç–æ—Ä–∏–∏" data-lang-key="ai_new_topic_title" data-lang-skip-content="true">
                                        <i data-lucide="plus"></i>
                                    </button>
                                </div>


                                <ul id="aiTopicsList" class="ai-chat-history-list">
                                     <!-- –°—é–¥–∞ JS –¥–æ–±–∞–≤–∏—Ç —Å–ø–∏—Å–æ–∫ —Ç–µ–º (—á–∞—Ç–æ–≤) -->
                                </ul>
                            </div>  

                            <!-- –†–£–ß–ö–ê –î–õ–Ø –ò–ó–ú–ï–ù–ï–ù–ò–Ø –†–ê–ó–ú–ï–†–ê (–æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) -->
                            <div id="aiSidebarHandle" class="ai-sidebar-handle"></div>
                        </div>

                        <div class="ai-chat-scroll-wrapper">
                            <div id="aiScrollbarTooltip" class="scrollbar-tooltip"></div>
                            <div id="aiChatMessages" class="ai-chat-messages">
                                <!-- –°—é–¥–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è -->
                            </div>
                            <div id="aiCustomScrollbar" class="ai-custom-scrollbar hidden">
                                <div id="aiScrollbarTrack" class="scrollbar-track">
                                    <div id="aiScrollbarDots" class="scrollbar-dots-container"></div>
                                </div>
                                <div id="aiScrollbarThumb" class="scrollbar-thumb"></div>
                            </div>

                        <button id="aiScrollToBottomBtn" class="ai-scroll-to-bottom-btn" title="–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é" data-lang-key="ai_scroll_to_bottom_title" data-lang-skip-content="true">
                            ‚Üì
                        </button>

                        </div>

                        <!-- ======== –ù–ê–ß–ê–õ–û –ù–û–í–û–ô –ü–†–ê–í–û–ô –ü–ê–ù–ï–õ–ò ======== -->
                        <div id="aiChatUserMessagesSidebar" class="ai-chat-user-messages-sidebar">
                            <ul id="aiUserMessagesList" class="ai-user-messages-list">
                                <!-- –°—é–¥–∞ JS –±—É–¥–µ—Ç –≤—Å—Ç–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è -->
                            </ul>
                        </div>


                        <!-- ======== –ö–û–ù–ï–¶ –ù–û–í–û–ô –ü–†–ê–í–û–ô –ü–ê–ù–ï–õ–ò ======== -->

                    </div> <!-- === –ó–ê–ö–†–´–í–ê–Æ–©–ò–ô —Ç–µ–≥ –¥–ª—è ai-chat-body-wrapper === -->









                    <div class="ai-chat-input-area">
                        <div class="ai-main-controls">
                            <!-- –õ–µ–≤–∞—è –≥—Ä—É–ø–ø–∞: –≤—Å–µ, —á—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å –ø–æ–∏—Å–∫–æ–º -->
                            <div class="ai-chat-footer-main-group">
                                <div class="ai-setting-group">
                                    <label for="aiGroundingToggleMain" data-lang-key="ai_grounding_label">–ü–æ–∏—Å–∫ –≤ Google</label>
                                    <label class="ai-toggle-switch">
                                        <input type="checkbox" id="aiGroundingToggleMain">
                                        <span class="ai-toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- –ü—Ä–∞–≤–∞—è –≥—Ä—É–ø–ø–∞: –¥–µ–π—Å—Ç–≤–∏—è —Å –¥–∏–∞–ª–æ–≥–æ–º -->
                            <div class="ai-chat-footer-actions">
                                <button id="aiShowSearchBtn" class="ai-action-btn" title="–ü–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º —á–∞—Ç–∞–º" data-lang-key="ai_search_all_chats_title" data-lang-skip-content="true">
                                    <i data-lucide="search"></i>
                                </button>
                                <button id="aiGenerateTestFromDialogBtn" class="ai-action-btn" title="–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç –∏–∑ –≤—Å–µ–≥–æ –¥–∏–∞–ª–æ–≥–∞" data-lang-key="ai_create_test_from_dialog_title" data-lang-skip-content="true">
                                    <i data-lucide="clipboard-list"></i>
                                </button>
                                <button id="aiShowAllUserMessagesBtn" class="ai-action-btn" title="–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –º–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è" data-lang-key="ai_show_all_user_messages_tooltip" data-lang-skip-content="true">
                                    <i data-lucide="user-round-search"></i>
                                </button>
                            </div>
                        </div>

                        <div id="aiReplyPanel" class="ai-reply-panel hidden">
                            <div class="ai-reply-info">
                                <span class="ai-reply-title" data-lang-key="ai_reply_to_message">–û—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ:</span>
                                <p id="aiReplyText" class="ai-reply-snippet"></p>
                            </div>
                            <button id="aiCancelReplyBtn" class="ai-cancel-reply-btn" title="–û—Ç–º–µ–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç" data-lang-key="ai_cancel_reply_title" data-lang-skip-content="true"><i data-lucide="x"></i></button>
                        </div>
                        <div class="ai-chat-input-container">
                            <input type="file" id="aiChatFileInput" class="hidden" accept="image/*,application/pdf,audio/*,text/plain" multiple>
                            <div id="aiAttachmentPreview" class="ai-attachment-preview hidden"></div>
                            <div id="aiChatMainInputRow" class="ai-chat-main-input-row">
                                <button id="aiChatAttachBtn" class="ai-chat-attach-btn" title="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª" data-lang-key="ai_attach_file_title" data-lang-skip-content="true">
                                    <i data-lucide="plus" class="ai-chat-input-icon"></i>
                                </button>
                                <textarea id="aiChatInput" placeholder="–°–ø—Ä–æ—Å–∏—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å..." data-lang-key="ai_chat_placeholder"></textarea>
                                <button id="aiChatSendBtn" class="advanced-send-btn">
                                    <i data-lucide="arrow-up"></i>
                                </button>
                            </div>
                        </div>
                    </div>







                    <div id="aiChatSearchContainer" class="ai-chat-search-container hidden">
                        <input type="text" id="aiChatSearchInputGlobal" placeholder="–ü–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º —á–∞—Ç–∞–º..." data-lang-key="ai_search_all_chats_placeholder">
                        <button id="aiCloseSearchBtn" class="ai-chat-control-btn"><i data-lucide="x"></i></button>
                        <div id="aiChatSearchResults" class="ai-chat-search-results hidden">
                            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                        </div>
                    </div>

                </div>
            </div>
        <audio id="notificationSound" src="https://notificationsounds.com/storage/sounds/file-sounds-1150-pristine.mp3" preload="auto"></audio>
    </div> 

    <!-- ======== –ù–ê–ß–ê–õ–û –ú–û–î–ê–õ–¨–ù–û–ì–û –û–ö–ù–ê –ö–û–ù–§–õ–ò–ö–¢–ê –°–ï–°–°–ò–ô ======== -->
    <div id="sessionConflictModal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 500px;">
            <h3 data-lang-key="session_conflict_title">–°–µ—Å—Å–∏—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç</h3>
            <p id="sessionConflictText" style="margin: 20px 0; line-height: 1.6;" data-lang-key="session_conflict_text">
                –î–ª—è —Ñ–∞–π–ª–∞ "{fileName}" —É–∂–µ –µ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å. –ß—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å?
            </p>
            <div class="modal-buttons vertical">
                <button id="overwriteSessionBtn" class="btn btn-danger" data-lang-key="session_overwrite_button">–ü–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å</button>
                <button id="saveNewSessionBtn" class="btn" data-lang-key="session_save_new_button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ –Ω–æ–≤—É—é</button>
                <button id="cancelConflictBtn" class="btn btn-secondary" data-lang-key="modal_cancel_button">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>
    <!-- ======== –ö–û–ù–ï–¶ –ú–û–î–ê–õ–¨–ù–û–ì–û –û–ö–ù–ê –ö–û–ù–§–õ–ò–ö–¢–ê –°–ï–°–°–ò–ô ======== -->
    
    <div id="testResultsModal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 600px;">
            <h3 id="testResultsModalTitle" data-lang-key="results_modal_title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ —Ç–µ—Å—Ç—É</h3>
            <div id="testResultsTableContainer" style="max-height: 400px; overflow-y: auto; margin-top: 20px;"></div>
            <div class="modal-buttons">
                <button onclick="ChatModule.closeModal('testResultsModal')" data-lang-key="auth_close_button">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <div id="aiExplanationModal" class="modal-overlay hidden">
        <div class="modal-content" style="text-align: left;">
            <div class="parser-label-container" style="margin-bottom: 10px;">
                <h3 data-lang-key="ai_explanation_title">üí° –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –æ—Ç –ò–ò</h3>
                <button id="aiExplanationTranslateBtn" class="btn-secondary-small hidden" data-lang-key="ai_toggle_translation_button">
                    –û—Ä–∏–≥–∏–Ω–∞–ª/–ü–µ—Ä–µ–≤–æ–¥
                </button>
            </div>
            <div id="aiExplanationQuestion" style="background: var(--input-bg-color); padding: 10px; border-radius: 5px; margin-bottom: 10px;"></div>
            <div class="settings-group" style="border: none; padding: 0; margin-bottom: 15px;">
                <label data-lang-key="ai_explanation_style_label">–°—Ç–∏–ª—å –æ–±—ä—è—Å–Ω–µ–Ω–∏—è:</label>
                <div id="aiExplanationStyleDropdown" class="style-dropdown">
                    <button id="aiExplanationStyleButton" class="style-dropdown-btn">
                        <span id="aiExplanationStyleText">–ü—Ä–æ—Å—Ç–æ</span>
                        <span class="dropdown-arrow">‚ñº</span>
                    </button>
                    <div id="aiExplanationStyleContent" class="style-dropdown-content hidden">
                        <a href="#" data-style="simple" data-lang-key="ai_style_simple">–ü—Ä–æ—Å—Ç–æ</a>
                        <a href="#" data-style="scientific" data-lang-key="ai_style_scientific">–ù–∞—É—á–Ω–æ</a>
                        <a href="#" data-style="associative" data-lang-key="ai_style_associative">–ê–Ω–∞–ª–æ–≥–∏—è</a>
                        <a href="#" data-style="stepbystep" data-lang-key="ai_style_stepbystep">–ü–æ—à–∞–≥–æ–≤–æ</a>
                        <a href="#" data-style="practical" data-lang-key="ai_style_practical">–ü—Ä–∞–∫—Ç–∏—á–Ω–æ</a>
                        <a href="#" data-style="visual" data-lang-key="ai_style_visual">–ù–∞–≥–ª—è–¥–Ω–æ</a>
                    </div>
                </div>
            </div>
            <div id="aiExplanationOutput"></div>
            <div class="modal-buttons" style="justify-content: space-between; margin-top: 20px;">
                <button id="copyExplanationBtn" data-lang-key="copy_button">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                <button onclick="ChatModule.closeModal('aiExplanationModal')" data-lang-key="auth_close_button">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js`;
    </script>     
      
    <script src="script.js" defer></script>   

    <div id="exitToast" class="exit-toast hidden" data-lang-key="exit_toast_text">
        –ù–∞–∂–º–∏—Ç–µ –µ—â–µ —Ä–∞–∑ –¥–ª—è –≤—ã—Ö–æ–¥–∞
    </div>

    <!-- ======================================================= -->
    <!-- ===    –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–û–ï –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø   === -->
    <!-- ======================================================= -->
    <div id="confirmModal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 420px;">
            <h3 id="confirmModalTitle">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ</h3>
            <p id="confirmModalText" style="margin: 20px 0; line-height: 1.6;"></p>
            <div id="confirmModalButtons" class="modal-buttons">
                <button id="confirmModalNoBtn" class="btn btn-secondary" data-lang-key="modal_cancel_button">–û—Ç–º–µ–Ω–∞</button>
                <button id="confirmModalYesBtn" class="btn btn-danger">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
            </div>
        </div>
    </div>
    <!-- ======================================================= -->
    <!-- ===   –ù–û–í–û–ï –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –í–í–û–î–ê –ü–ê–†–û–õ–Ø –ö–ê–ù–ê–õ–ê   === -->
    <!-- ======================================================= -->
    <div id="channelPasswordModal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 420px;">
            <h3 id="channelPasswordModalTitle"></h3>
            <p id="channelPasswordModalText" style="margin: 20px 0; line-height: 1.6;"></p>
            
            <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–±–µ—Ä—Ç–∫—É –¥–ª—è –∏–∫–æ–Ω–∫–∏ "–≥–ª–∞–∑–∞", –∫–∞–∫ –≤ –æ–∫–Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
            <div class="password-wrapper" style="margin-bottom: 25px;">
                <input type="password" id="channelPasswordInputModal" class="auth-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å...">
                <span class="toggle-password"><i data-lucide="eye"></i></span>
            </div>

            <div id="channelPasswordModalButtons" class="modal-buttons">
                <button id="channelPasswordCancelBtn" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
                <button id="channelPasswordConfirmBtn" class="btn">–í–æ–π—Ç–∏</button>
            </div>
        </div>
    </div>





    <!-- ======================================================= -->
    <!-- ===  –ù–û–í–û–ï –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –°–û–ó–î–ê–ù–ò–Ø –ê–£–î–ò–¢–û–†–ò–ò    === -->
    <!-- ======================================================= -->
    <div id="audienceCreateModal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 420px;">
            <h3 id="audienceCreateModalTitle">–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –ê—É–¥–∏—Ç–æ—Ä–∏–∏</h3>
            <p id="audienceCreateModalText" style="margin: 20px 0; line-height: 1.6;">–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –≤–∞—à–µ–π –ø—É–±–ª–∏—á–Ω–æ–π –ê—É–¥–∏—Ç–æ—Ä–∏–∏. –û–Ω–æ –±—É–¥–µ—Ç –≤–∏–¥–Ω–æ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.</p>
            
            <input type="text" id="audienceNameInput" class="auth-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ê—É–¥–∏—Ç–æ—Ä–∏–∏..." style="margin-bottom: 25px;">

            <div id="audienceCreateModalButtons" class="modal-buttons">
                <button id="audienceCreateCancelBtn" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
                <button id="audienceCreateConfirmBtn" class="btn">–°–æ–∑–¥–∞—Ç—å</button>
            </div>
        </div>
    </div>




    <!-- ======================================================= -->
    <!-- ===    –ù–û–í–û–ï –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –°–û–ó–î–ê–ù–ò–Ø –¢–ï–ú–´       === -->
    <!-- ======================================================= -->
    <div id="topicCreateModal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 420px;">
            <h3 id="topicCreateModalTitle" data-lang-key="topic_create_modal_title">–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –¢–µ–º—ã</h3>
            <p id="topicCreateModalText" style="margin: 20px 0; line-height: 1.6;" data-lang-key="topic_create_modal_text">–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –≤–∞—à–µ–π –Ω–æ–≤–æ–π –¢–µ–º—ã (—á–∞—Ç–∞) –≤ —ç—Ç–æ–π –ê—É–¥–∏—Ç–æ—Ä–∏–∏.</p>
            
            <input type="text" id="topicNameInput" class="auth-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –¢–µ–º—ã..." data-lang-key="topic_create_placeholder" style="margin-bottom: 25px;">

            <div id="topicCreateModalButtons" class="modal-buttons">
                <button id="topicCreateCancelBtn" class="btn btn-secondary" data-lang-key="modal_cancel_button">–û—Ç–º–µ–Ω–∞</button>
                <button id="topicCreateConfirmBtn" class="btn" data-lang-key="audience_create_button">–°–æ–∑–¥–∞—Ç—å</button>
            </div>
        </div>
    </div>
    <!-- ======================================================= -->
    <!-- ======================================================= -->
    <!-- ===      –ù–û–í–û–ï –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –ü–†–û–°–ú–û–¢–†–ê –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô === -->
    <!-- ======================================================= -->
    <div id="imagePreviewModal" class="modal-overlay hidden">
        <div class="image-preview-content">
            <img id="previewImage" src="" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è">
        </div>
        <button class="close-image-preview" title="–ó–∞–∫—Ä—ã—Ç—å"><i data-lucide="x"></i></button>
    </div>
    <!-- ======================================================= -->
    <!-- ===      –ù–û–í–û–ï –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –ü–†–û–°–ú–û–¢–†–ê –¢–ï–ö–°–¢–ê   === -->
    <!-- ======================================================= -->
    <div id="textPreviewModal" class="modal-overlay hidden">
        <div class="text-preview-content">
            <div class="text-preview-header">
                <h3 id="textPreviewFilename">–ò–º—è —Ñ–∞–π–ª–∞</h3>
                <button class="close-text-preview" title="–ó–∞–∫—Ä—ã—Ç—å"><i data-lucide="x"></i></button>
            </div>
            <pre id="textPreviewBody"></pre>
        </div>
    </div>
    <!-- ======================================================= -->
    <!-- ===   –ù–û–í–û–ï –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø –ê–£–î–ò–¢–û–†–ò–ò === -->
    <!-- ======================================================= -->
    <div id="audienceEditModal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 480px;">
            <h3 id="audienceEditModalTitle" data-lang-key="ai_audience_settings_title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ê—É–¥–∏—Ç–æ—Ä–∏–∏</h3>
            
            <div class="settings-group" style="text-align: left; border-bottom: none; padding-bottom: 0;">
                <label for="audienceNameEditInput" style="font-weight: 500;" data-lang-key="ai_audience_name_label">–ù–∞–∑–≤–∞–Ω–∏–µ –ê—É–¥–∏—Ç–æ—Ä–∏–∏:</label>
                <input type="text" id="audienceNameEditInput" class="auth-input" placeholder="–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ..." data-lang-key="ai_audience_name_placeholder">

                <label for="audiencePasswordEditInput" style="font-weight: 500; margin-top: 15px;" data-lang-key="ai_audience_password_label">–ü–∞—Ä–æ–ª—å (–ø—É—Å—Ç–æ = –±–µ–∑ –ø–∞—Ä–æ–ª—è):</label>
                <div class="password-wrapper">
                    <input type="password" id="audiencePasswordEditInput" class="auth-input" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å..." data-lang-key="ai_audience_password_placeholder">
                    <span class="toggle-password"><i data-lucide="eye"></i></span>
                </div>
            </div>

            <!-- –ë–ª–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞–º–∏ -->
            <div class="moderator-management-section">
                <h4 data-lang-key="ai_moderator_management">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞–º–∏</h4>
                <div class="moderator-add-form">
                    <input type="email" id="moderatorEmailInput" class="auth-input" placeholder="Email –Ω–æ–≤–æ–≥–æ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞..." data-lang-key="ai_moderator_email_placeholder">
                    <button id="addModeratorBtn" class="btn-secondary-small" data-lang-key="ai_moderator_add_btn">–î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
                <ul id="moderatorsList" class="moderator-list">
                    <!-- –°—é–¥–∞ JS –¥–æ–±–∞–≤–∏—Ç —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤ -->
                </ul>
            </div>

            <div id="audienceEditModalButtons" class="modal-buttons" style="margin-top: 25px;">
                <button id="cancelAudienceEditBtn" class="btn btn-secondary" data-lang-key="modal_cancel_button">–û—Ç–º–µ–Ω–∞</button>
                <button id="saveAudienceSettingsBtn" class="btn" data-lang-key="modal_save_button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>





    <!-- ======================================================= -->
    <!-- ===   –ù–û–í–û–ï –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø –õ–ï–ì–ï–ù–î–´ === -->
    <!-- ======================================================= -->
    <div id="legendEditModal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 420px;">
            <h3 id="legendEditModalTitle" style="display: flex; align-items: center; gap: 10px;">
                <span id="legendEditModalColorSwatch" class="legend-color-swatch"></span>
                <span data-lang-key="ai_legend_edit_title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–µ–≥–µ–Ω–¥—ã</span>
            </h3>
            <p style="margin: 20px 0; line-height: 1.6;" data-lang-key="ai_legend_edit_text">–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è —ç—Ç–æ–≥–æ —Ü–≤–µ—Ç–∞.</p>
            
            <input type="text" id="legendNameInput" class="auth-input" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ..." data-lang-key="ai_legend_edit_placeholder" style="margin-bottom: 25px;">

            <div class="modal-buttons">
                <button id="legendEditCancelBtn" class="btn btn-secondary" data-lang-key="modal_cancel_button">–û—Ç–º–µ–Ω–∞</button>
                <button id="legendEditConfirmBtn" class="btn" data-lang-key="modal_save_button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>





    <!-- ======================================================= -->
    <!-- ===   –ù–û–í–û–ï –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –ì–ï–ù–ï–†–ê–¶–ò–ò –¢–ï–°–¢–ê –ò–ó AI-–ß–ê–¢–ê === -->
    <!-- ======================================================= -->
    <div id="aiTestFromMessageModal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 480px; text-align: left;">
            <h3 data-lang-key="ai_test_from_msg_title">–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è</h3>
            <p style="margin: 20px 0; line-height: 1.6;" data-lang-key="ai_test_from_msg_text">
                –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –ò–ò.
            </p>
            
            <input type="hidden" id="aiTestFromMessageIndex">
            
            <!-- ======== –ù–ê–ß–ê–õ–û –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ì–û –ë–õ–û–ö–ê –°–õ–ê–ô–î–ï–†–ê ======== -->
            <div class="settings-group" style="border: none; padding: 0;">
                <label for="aiTestMsgQuestionCount" data-lang-key="ai_question_count_label" style="font-weight: 500;">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤:</label>
                <div class="time-limit-wrapper" style="margin-top: 10px;">
                    <div class="range-inputs-container time-limit-input-container">
                         <input type="number" id="aiTestMsgQuestionCount" min="1" max="50" value="5" step="1" class="range-input">
                    </div>
                    <div class="single-slider-container time-slider-modern">
                        <div id="aiTestMsgSliderProgress" class="slider-progress"></div>
                        <input type="range" id="aiTestMsgQuestionSlider" min="1" max="50" value="5" step="1">
                    </div>
                </div>
            </div>
            <!-- ======== –ö–û–ù–ï–¶ –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ì–û –ë–õ–û–ö–ê –°–õ–ê–ô–î–ï–†–ê ======== -->

            <div class="settings-group" style="border: none; padding: 0;">
                <label for="aiTestMsgAnswerCount" data-lang-key="ai_answer_count_label" style="font-weight: 500;">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞:</label>
                <select id="aiTestMsgAnswerCount" style="width: 100%; padding: 8px; border-radius: 4px; margin-top: 10px;">
                    <option value="3">3</option>
                    <option value="4" selected data-lang-key="ai_option_default">4 (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                </select>
            </div>
            
            <div class="settings-group" style="border: none; padding: 0;">
                <label for="aiTestMsgDifficulty" data-lang-key="ai_test_difficulty_label" style="font-weight: 500;">–°–ª–æ–∂–Ω–æ—Å—Ç—å:</label>
                <select id="aiTestMsgDifficulty" style="width: 100%; padding: 8px; border-radius: 4px; margin-top: 10px;">
                    <option value="easy" data-lang-key="ai_test_difficulty_easy">–ü—Ä–æ—Å—Ç–æ–π</option>
                    <option value="medium" selected data-lang-key="ai_test_difficulty_medium">–°—Ä–µ–¥–Ω–∏–π</option>
                    <option value="hard" data-lang-key="ai_test_difficulty_hard">–°–ª–æ–∂–Ω—ã–π</option>
                </select>
            </div>

            <!-- ======== –ù–ê–ß–ê–õ–û –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ì–û –ë–õ–û–ö–ê –ß–ï–ö–ë–û–ö–°–ê ======== -->
            <div class="settings-group" style="border: none; padding: 0; margin-top: 15px;">
                <label class="category-checkbox-label" style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 5px 0;">
                    <input type="checkbox" id="aiTestMsgAutoCategory" style="margin: 0; width: 18px; height: 18px;">
                    <span data-lang-key="ai_auto_category_label">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</span>
                </label>
            </div>
            <!-- ======== –ö–û–ù–ï–¶ –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ì–û –ë–õ–û–ö–ê –ß–ï–ö–ë–û–ö–°–ê ======== -->

            <div class="modal-buttons" style="margin-top: 25px;">
                <button id="cancelAiTestGenerationBtn" class="btn btn-secondary" data-lang-key="modal_cancel_button">–û—Ç–º–µ–Ω–∞</button>
                <button id="confirmAiTestGenerationBtn" class="btn" data-lang-key="ai_generate_from_text_button">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
        </div>
    </div>
    <!-- ======================================================= -->

</body>
</html>
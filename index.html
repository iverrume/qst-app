<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QSTiUM</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" href="favicon.png">
    <link rel="manifest" href="/manifest.json">
    <script type="module" src="https://cdn.jsdelivr.net/npm/emoji-picker-element@^1/index.js"></script>
    <style>
        #gradusButton {
            line-height: 1.3;
            padding-top: 12px;
            padding-bottom: 12px;
        }
        #gradusButton .gradus-subtitle {
            display: block;
            font-size: 0.75em;
            font-weight: normal;
            margin-top: 4px;
        }
    </style>
</head>
<body>


    <div class="app-wrapper">
        <div class="container">
            <div class="header-controls">
                <h1></h1>
                <div class="header-buttons">

                    <button id="copyQuestionBtnQuiz" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å" class="hidden">üìã</button> 

                    <div class="dropdown hidden" id="webSearchDropdown">
                        <button id="searchWebButton" title="–ù–∞–π—Ç–∏ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ">üåê</button>
                        <div id="searchDropdownContent" class="dropdown-content">
                            <a href="#" data-engine="google">Google</a>
                            <a href="#" data-engine="yandex">–Ø–Ω–¥–µ–∫—Å</a>
                            <a href="#" data-engine="perplexity">Perplexity</a>
                        </div>
                    </div>
                    <button id="chatToggle" title="–û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç">
                         üí¨ <span id="chatNotificationBadge" class="chat-badge hidden">0</span>
                    </button>
                    
                    <button id="quickModeToggle" title="–ë—ã—Å—Ç—Ä—ã–π —Ä–µ–∂–∏–º (–ê–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥)" class="hidden">‚ö°</button> 

                    <button id="triggerWordToggle" title="–¢—Ä–∏–≥–≥–µ—Ä-—Å–ª–æ–≤–∞" class="hidden">‚úçÔ∏è</button>
                    <button id="themeToggle" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">üåô</button>
                    <button id="languageToggle" title="–°–º–µ–Ω–∏—Ç—å —è–∑—ã–∫">–†—É—Å</button>
                    <button id="favoriteQuestionBtn" title="–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ" class="hidden">‚≠ê</button>
                </div>
            </div>

            <div class="file-upload-area" id="fileUploadArea">
                <div id="searchContainer">
                    <label for="searchQueryInput" data-lang-key="search_in_db">–ü–æ–∏—Å–∫ –≤–æ–ø—Ä–æ—Å–∞ –≤ –±–∞–∑–µ:</label>
                    <input type="text" id="searchQueryInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —á–∞—Å—Ç—å —Ç–µ–∫—Å—Ç–∞ –≤–æ–ø—Ä–æ—Å–∞..." data-lang-key="search_placeholder">
                    <button id="searchButton" data-lang-key="find_button">–ù–∞–π—Ç–∏</button>
                </div>
                <p style="text-align: center; margin: 15px 0; color: var(--secondary-text-color);" data-lang-key="or_divider">-- –∏–ª–∏ --</p>
                <label for="fileInput" data-lang-key="choose_file">–í—ã–±–µ—Ä–∏—Ç–µ .qst –ª–∏–±–æ .txt —Ñ–∞–π–ª —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</label>
                <input type="file" id="fileInput">
                <p style="text-align: center; margin: 15px 0; color: var(--secondary-text-color);" data-lang-key="or_divider">-- –∏–ª–∏ --</p>
                <button id="gradusButton" style="width: 100%; background-color: #6c757d; color: white;">
                    <span data-lang-key="gradus_button">GRADUS</span>
                    <span class="gradus-subtitle">(General Repository for Academic Data, Utility & Structure)</span>
                </button>

                <p style="text-align: center; margin: 15px 0; color: var(--secondary-text-color);" data-lang-key="or_divider">-- –∏–ª–∏ --</p>
                <button id="parserButton" style="width: 100%; background-color: #17a2b8; color: white;">
                    <span>‚öôÔ∏è –ü–∞—Ä—Å–µ—Ä</span>
                    <span class="gradus-subtitle">(–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –≤ —Ñ–æ—Ä–º–∞—Ç .qst)</span>
                </button>
              
                <div id="recentFilesArea" class="hidden">
                    <h4 data-lang-key="recent_files">–ù–µ–¥–∞–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ:</h4>
                    <ul id="recentFilesList"></ul>
                </div>
            </div>

            <div id="searchResultsContainer" class="view hidden">
                <div class="search-results-header">
                    <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</h2>
                    <button id="backToSearchButton" class="btn btn-secondary">–ù–æ–≤—ã–π –ø–æ–∏—Å–∫</button>
                </div>

                <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º -->
                <div class="search-navigation hidden" id="searchNavigation">
                    <button class="nav-arrow" id="prevResultBtn" title="–ü—Ä–µ–¥—ã–¥—É—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç">‚Üê</button>
                    <span id="resultCounter" class="result-counter">0 / 0</span>
                    <button class="nav-arrow" id="nextResultBtn" title="–°–ª–µ–¥—É—é—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç">‚Üí</button>
                </div>

                <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –æ–¥–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ -->
                <div id="searchResultCards">
                    <!-- –°—é–¥–∞ –±—É–¥–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –æ–¥–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ -->
                </div>
            </div>

            <div id="gradusFoldersContainer" class="hidden">
                <h2>–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ GRADUS</h2>
                <div id="gradusBreadcrumbs"></div>
                <div id="gradusFolderList"></div>
                <button id="backToFileUploadButton" style="margin-top: 15px;">–ù–∞–∑–∞–¥ –∫ –≥–ª–∞–≤–Ω–æ–º—É —ç–∫—Ä–∞–Ω—É</button>
            </div>

            <div id="quizSetupArea" class="hidden">
                <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–∞</h2>
                <div class="settings-group">
                    <label for="timeLimit">–õ–∏–º–∏—Ç –≤—Ä–µ–º–µ–Ω–∏ (–º–∏–Ω—É—Ç—ã, 0 - –±–µ–∑ –ª–∏–º–∏—Ç–∞):</label>
                    <input type="range" id="timeLimit" min="0" max="180" value="0" step="10">
                    <span id="timeLimitValue">0</span> –º–∏–Ω
                </div>
                <div class="settings-group">
                    <label for="questionRangeStart">–î–∏–∞–ø–∞–∑–æ–Ω –≤–æ–ø—Ä–æ—Å–æ–≤:</label>
                    –û—Ç <input type="number" id="questionRangeStart" min="1" value="1" class="range-input">
                    –î–æ <input type="number" id="questionRangeEnd" min="1" class="range-input">
                    <span id="maxQuestionsInfo"></span>
                </div>
                <div class="settings-group">
                    <input type="checkbox" id="shuffleQuestions">
                    <label for="shuffleQuestions">–ü–µ—Ä–µ–º–µ—à–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã</label>
                </div>
                <div class="settings-group">
                    <input type="checkbox" id="shuffleAnswers">
                    <label for="shuffleAnswers">–ü–µ—Ä–µ–º–µ—à–∞—Ç—å –æ—Ç–≤–µ—Ç—ã</label>
                </div>
                <div class="settings-group">
                    <input type="checkbox" id="feedbackMode">
                    <label for="feedbackMode">–†–µ–∂–∏–º –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—à–∏–±–∫–∏)</label>
                </div>
                <button id="startQuizButton">–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç</button>
                <button id="generateCheatSheetButton" style="margin-top: 10px;">–°–æ–∑–¥–∞—Ç—å —à–ø–æ—Ä—É</button>
                <button id="chooseAnotherFileButton" style="margin-top: 10px;">–í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π —Ñ–∞–π–ª</button>
            </div>

            <div id="cheatSheetResultArea" class="hidden">
                <h2>–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–ø–æ—Ä–∞:</h2>
                <textarea id="cheatSheetOutput" readonly rows="15"></textarea>
                <button id="downloadCheatSheetButton">–°–∫–∞—á–∞—Ç—å —à–ø–æ—Ä—É (.txt)</button>
                <button id="backToSettingsButton" style="margin-top: 10px;">–ù–∞–∑–∞–¥ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º</button>
            </div>

            <div id="quizArea" class="hidden">
                <div id="timerDisplay" class="hidden">–í—Ä–µ–º—è: <span id="timeLeft">--:--</span></div>
                <div id="questionContainer">
                    <h2 id="questionText"></h2>
                    <ul id="answerOptions"></ul>
                </div>
                <div id="feedbackArea"></div>
                <div id="questionNavigationControls">
                    <button id="prevQuestionButton" disabled>–ü—Ä–µ–¥—ã–¥—É—â–∏–π</button>
                    <button id="nextButton">–°–ª–µ–¥—É—é—â–∏–π</button>
                </div>
                <div id="score">
                    <p>–í–æ–ø—Ä–æ—Å: <span id="currentQuestionNum">0</span> / <span id="totalQuestionsNum">0</span></p>
                    <p>–ü—Ä–∞–≤–∏–ª—å–Ω–æ: <span id="correctAnswersCount">0</span></p>
                </div>
                <div id="quickNavPanel" class="hidden">
                    <h4>–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º:</h4>
                    <div id="quickNavButtons"></div>
                </div>
                <div class="quiz-footer-controls">
                     <button id="finishTestButton" class="finish-test-early hidden">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç</button>
                </div>
            </div>

            <div id="resultsArea" class="hidden">
                <h2>–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!</h2>
                <p>–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <span id="finalCorrect"></span> –∏–∑ <span id="finalTotal"></span>.</p>
                <p>–¢–æ—á–Ω–æ—Å—Ç—å: <span id="finalPercentage"></span>%</p>
                <div id="feedbackDownloadArea" class="hidden">
                    <button id="downloadErrorsButton">–°–∫–∞—á–∞—Ç—å –Ω–µ–æ—Ç–≤–µ—á–µ–Ω–Ω—ã–µ/–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã</button>
                </div>
                <div id="errorReviewArea" class="hidden">
                     <button id="reviewErrorsButton">–†–∞–±–æ—Ç–∞ –Ω–∞–¥ –æ—à–∏–±–∫–∞–º–∏</button>
                </div>
                <div id="triggeredQuizDownloadArea" class="hidden">
                    <button id="downloadTriggeredQuizButton">–°–∫–∞—á–∞—Ç—å —Ç–µ—Å—Ç —Å —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏</button>
                </div>
                <button id="restartButton">–ü—Ä–æ–π—Ç–∏ –¥—Ä—É–≥–æ–π —Ç–µ—Å—Ç</button>
            </div>


            <div id="parserArea" class="hidden">
                <h2>–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –≤ .qst</h2>
                <p style="text-align: center; color: var(--secondary-text-color);">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –∏–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç —Ç–µ—Å—Ç–∞.</p>

                <div class="settings-group">

                    <div class="parser-label-container">
                        <label for="parserFileInput">1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª (.txt) –∏–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –Ω–∏–∂–µ:</label>
                        <button id="clearParserInputBtn" class="btn-secondary-small">–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª–µ</button>
                    </div>

                    <input type="file" id="parserFileInput" accept=".txt">
                    <textarea id="parserInput" rows="10" placeholder="–ò–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ —Ç–µ–∫—Å—Ç –∏–∑ –≤–∞—à–µ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞..."></textarea>
                </div>

                <div class="settings-group">
                    <label for="parserPatternSelect">2. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç (–∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –¥–ª—è –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è):</label>
                    <select id="parserPatternSelect" style="width: 100%; padding: 8px; border-radius: 4px;">
                        <option value="auto" selected>-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ --</option>
                        <!-- –°—é–¥–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏–∑ JS -->
                    </select>
                </div>
                
                <div class="settings-group" style="text-align: center;">
                    <button id="runParserBtn">3. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>

                <div id="parserOutputArea" class="hidden">
                    <hr>
                    <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç:</h3>
                    <textarea id="parserOutput" readonly rows="10"></textarea>
                    <button id="downloadParsedBtn">–°–∫–∞—á–∞—Ç—å .qst —Ñ–∞–π–ª</button>
                </div>

                <button id="backToMainFromParserBtn" style="margin-top: 15px; background-color: var(--button-secondary-bg);">–ù–∞–∑–∞–¥</button>
            </div>


        </div>

        

        <footer>
            <p>prod by @iverrum</p>
        </footer>
        
        <!-- === –ù–ê–ß–ê–õ–û –ù–û–í–û–ì–û –ö–û–î–ê: –ó–í–£–ö –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø === -->
        <audio id="notificationSound" src="https://notificationsounds.com/storage/sounds/file-sounds-1150-pristine.mp3" preload="auto"></audio> preload="auto"></audio>
        <!-- === –ö–û–ù–ï–¶ –ù–û–í–û–ì–û –ö–û–î–ê === -->

    </div> <!-- –ö–æ–Ω–µ—Ü .app-wrapper -->


    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <script src="script.js"></script>
</body>
</html>
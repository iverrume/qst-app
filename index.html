<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QSTiUM</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" href="favicon.png">
    <link rel="manifest" href="/manifest.json">
    <script type="module" src="https://cdn.jsdelivr.net/npm/emoji-picker-element@^1/index.js"></script>
    <style>
        #gradusButton {
            line-height: 1.3;
            padding-top: 12px;
            padding-bottom: 12px;
        }
        #gradusButton .gradus-subtitle {
            display: block;
            font-size: 0.75em;
            font-weight: normal;
            margin-top: 4px;
        }
    </style>
</head>

<body>

    <!-- === –ù–ê–ß–ê–õ–û –ù–û–í–û–ì–û –ö–û–î–ê: –ü–õ–ê–®–ö–ê –û–ë–ù–û–í–õ–ï–ù–ò–Ø === -->
    <div id="updateNotification" class="update-notification hidden">
        <span data-lang-key="update_available_text">–î–æ—Å—Ç—É–ø–Ω–∞ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è!</span>
        <button id="updateBtn" data-lang-key="update_button_text">–û–±–Ω–æ–≤–∏—Ç—å</button>
    </div>
    <!-- === –ö–û–ù–ï–¶ –ù–û–í–û–ì–û –ö–û–î–ê === -->
    <div class="app-wrapper">
        <div class="container">
            <div class="header-controls">
                <h1></h1>
                <div class="header-buttons">
                    <!-- –≠—Ç–∏ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ JS, title —É–∂–µ –≤ LANG_PACK -->
                    <button id="copyQuestionBtnQuiz" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å" class="hidden">üìã</button> 
                    <div class="dropdown hidden" id="webSearchDropdown">
                        <button id="searchWebButton" title="–ù–∞–π—Ç–∏ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ">üåê</button>
                        <div id="searchDropdownContent" class="dropdown-content">
                            <a href="#" data-engine="google">Google</a>
                            <a href="#" data-engine="yandex">–Ø–Ω–¥–µ–∫—Å</a>
                            <a href="#" data-engine="perplexity">Perplexity</a>
                        </div>
                    </div>
                    <button id="chatToggle" title="–û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç">
                         üí¨ <span id="chatNotificationBadge" class="chat-badge hidden">0</span>
                    </button>
                    <button id="quickModeToggle" title="–ë—ã—Å—Ç—Ä—ã–π —Ä–µ–∂–∏–º (–ê–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥)" class="hidden">‚ö°</button> 
                    <button id="triggerWordToggle" title="–¢—Ä–∏–≥–≥–µ—Ä-—Å–ª–æ–≤–∞" class="hidden">‚úçÔ∏è</button>
                    <button id="themeToggle" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">üåô</button>
                    <button id="languageToggle" title="–°–º–µ–Ω–∏—Ç—å —è–∑—ã–∫">–†—É—Å</button>
                    <button id="favoriteQuestionBtn" title="–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ" class="hidden">‚≠ê</button>
                    <button id="translateQuestionBtn" title="–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤–æ–ø—Ä–æ—Å" class="hidden">‡§Ö–∞</button>
                </div>
            </div>

            <div class="file-upload-area" id="fileUploadArea">
                <div id="searchContainer">
                    <label for="searchQueryInput" data-lang-key="search_in_db">–ü–æ–∏—Å–∫ –≤–æ–ø—Ä–æ—Å–∞ –≤ –±–∞–∑–µ:</label>
                    <input type="text" id="searchQueryInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —á–∞—Å—Ç—å —Ç–µ–∫—Å—Ç–∞ –≤–æ–ø—Ä–æ—Å–∞..." data-lang-key="search_placeholder">
                    <button id="searchButton" data-lang-key="find_button">–ù–∞–π—Ç–∏</button>
                </div>
                <p style="text-align: center; margin: 15px 0; color: var(--secondary-text-color);" data-lang-key="or_divider">-- –∏–ª–∏ --</p>
                <label for="fileInput" data-lang-key="choose_file">–í—ã–±–µ—Ä–∏—Ç–µ .qst –ª–∏–±–æ .txt —Ñ–∞–π–ª —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</label>
                <input type="file" id="fileInput">
                <p style="text-align: center; margin: 15px 0; color: var(--secondary-text-color);" data-lang-key="or_divider">-- –∏–ª–∏ --</p>
                <button id="gradusButton">
                    <span data-lang-key="gradus_button_main">GRADUS</span>
                    <span class="gradus-subtitle" data-lang-key="gradus_subtitle">(General Repository for Academic Data, Utility & Structure)</span>
                </button>
                <p style="text-align: center; margin: 15px 0; color: var(--secondary-text-color);" data-lang-key="or_divider">-- –∏–ª–∏ --</p>
                <button id="parserButton">
                    <span data-lang-key="parser_button_main">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏</span>
                    <span class="gradus-subtitle" data-lang-key="parser_subtitle">—Ç–µ–∫—Å—Ç –≤ —Ñ–æ—Ä–º–∞—Ç .qst</span>
                </button>
                <div id="savedSessionArea" class="hidden">
                    <h4 data-lang-key="continue_sessions">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å:</h4>
                    <div id="savedSessionList"></div>
                </div>
                <div id="recentFilesArea" class="hidden">
                    <h4 data-lang-key="recent_files">–ù–µ–¥–∞–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ:</h4>
                    <ul id="recentFilesList"></ul>
                </div>
            </div>

            <div id="searchResultsContainer" class="view hidden">
                <div class="search-results-header">
                    <h2 data-lang-key="search_results_title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</h2>
                    <button id="backToSearchButton" class="btn btn-secondary" data-lang-key="back_to_search">–ù–æ–≤—ã–π –ø–æ–∏—Å–∫</button>
                </div>

                <div id="searchNavigation" class="search-navigation hidden">
                    <button id="prevResultBtn" class="nav-arrow" disabled><</button>
                    <span id="resultCounter">0 / 0</span>
                    <button id="nextResultBtn" class="nav-arrow" disabled>></button>
                </div>

                <div id="searchResultCards">
                    <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –±—É–¥—É—Ç –≤—Å—Ç–∞–≤–ª—è—Ç—å—Å—è —Å—é–¥–∞ -->
                </div>
            </div>

            <div id="gradusFoldersContainer" class="hidden">
                <h2 data-lang-key="nav_gradus">–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ GRADUS</h2>
                <div id="gradusBreadcrumbs"></div>
                <div id="gradusFolderList"></div>
                <button id="backToFileUploadButton" style="margin-top: 15px;" data-lang-key="back_to_main">–ù–∞–∑–∞–¥ –∫ –≥–ª–∞–≤–Ω–æ–º—É —ç–∫—Ä–∞–Ω—É</button>
            </div>

            <div id="quizSetupArea" class="hidden">
                <h2 data-lang-key="quiz_settings_title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–∞</h2>
                <div class="settings-group">
                    <label for="timeLimit" data-lang-key="time_limit">–õ–∏–º–∏—Ç –≤—Ä–µ–º–µ–Ω–∏ (–º–∏–Ω—É—Ç—ã, 0 - –±–µ–∑ –ª–∏–º–∏—Ç–∞):</label>
                    <input type="range" id="timeLimit" min="0" max="180" value="0" step="10">
                    <span id="timeLimitValue">0</span> <span data-lang-key="time_limit_minutes">–º–∏–Ω</span>
                </div>
                <div class="settings-group">
                    <label for="questionRangeStart" data-lang-key="question_range">–î–∏–∞–ø–∞–∑–æ–Ω –≤–æ–ø—Ä–æ—Å–æ–≤:</label>
                    <span data-lang-key="range_from">–û—Ç</span> <input type="number" id="questionRangeStart" min="1" value="1" class="range-input">
                    <span data-lang-key="range_to">–î–æ</span> <input type="number" id="questionRangeEnd" min="1" class="range-input">
                    <span id="maxQuestionsInfo"></span>
                </div>
                <div class="settings-group">
                    <input type="checkbox" id="shuffleQuestions">
                    <label for="shuffleQuestions" data-lang-key="shuffle_questions">–ü–µ—Ä–µ–º–µ—à–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã</label>
                </div>
                <div class="settings-group">
                    <input type="checkbox" id="shuffleAnswers">
                    <label for="shuffleAnswers" data-lang-key="shuffle_answers">–ü–µ—Ä–µ–º–µ—à–∞—Ç—å –æ—Ç–≤–µ—Ç—ã</label>
                </div>
                <div class="settings-group">
                    <input type="checkbox" id="feedbackMode">
                    <label for="feedbackMode" data-lang-key="feedback_mode">–†–µ–∂–∏–º –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—à–∏–±–∫–∏)</label>
                </div>
                <div class="settings-group">
                    <input type="checkbox" id="readingMode">
                    <label for="readingMode" data-lang-key="reading_mode">–†–µ–∂–∏–º —á—Ç–µ–Ω–∏—è (–ø–µ—Ä–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –≤–µ—Ä–Ω—ã–π)</label>
                </div>
                <div class="settings-group">
                    <input type="checkbox" id="flashcardsMode">
                    <label for="flashcardsMode" data-lang-key="flashcards_mode">–†–µ–∂–∏–º –∫–∞—Ä—Ç–æ—á–µ–∫ (–≤–æ–ø—Ä–æ—Å/–æ—Ç–≤–µ—Ç)</label>
                </div>
                <button id="startQuizButton" data-lang-key="start_quiz_button">–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç</button>
                <button id="generateCheatSheetButton" style="margin-top: 10px;" data-lang-key="generate_cheat_sheet_button">–°–æ–∑–¥–∞—Ç—å —à–ø–æ—Ä—É</button>
                <button id="chooseAnotherFileButton" style="margin-top: 10px;" data-lang-key="choose_another_file_button">–í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π —Ñ–∞–π–ª</button>
            </div>

            <div id="cheatSheetResultArea" class="hidden">
                <h2 data-lang-key="cheat_sheet_title">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–ø–æ—Ä–∞:</h2>
                <textarea id="cheatSheetOutput" readonly rows="15"></textarea>
                <button id="downloadCheatSheetButton" data-lang-key="download_cheat_sheet_button">–°–∫–∞—á–∞—Ç—å —à–ø–æ—Ä—É (.txt)</button>
                <button id="backToSettingsButton" style="margin-top: 10px;" data-lang-key="back_to_settings_button">–ù–∞–∑–∞–¥ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º</button>
            </div>

            <div id="quizArea" class="hidden">
                <div id="timerDisplay" class="hidden"><span data-lang-key="timer_label">–í—Ä–µ–º—è:</span> <span id="timeLeft">--:--</span></div>
                <div id="questionContainer">
                    <div id="questionText"></div>
                    <ul id="answerOptions"></ul>
                    <div id="feedbackArea" class="feedback-area"></div>
                </div>
                <div id="questionNavigationControls">
                    <button id="prevQuestionButton" disabled data-lang-key="prev_question_button">–ü—Ä–µ–¥—ã–¥—É—â–∏–π</button>
                    <button id="nextButton" data-lang-key="next_question_button">–°–ª–µ–¥—É—é—â–∏–π</button>
                </div>
                <div id="score">
                    <p><span data-lang-key="question_label">–í–æ–ø—Ä–æ—Å:</span> <span id="currentQuestionNum">0</span> / <span id="totalQuestionsNum">0</span></p>
                    <p><span data-lang-key="correct_label">–ü—Ä–∞–≤–∏–ª—å–Ω–æ:</span> <span id="correctAnswersCount">0</span></p>
                </div>
                <div id="quickNavPanel" class="hidden">
                    <h4 data-lang-key="quick_nav_title">–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º:</h4>
                    <div id="quickNavButtons"></div>
                </div>
                <div class="quiz-footer-controls">
                     <button id="downloadTranslatedTxtButton" class="hidden">–°–∫–∞—á–∞—Ç—å (txt)</button>
                     <button id="downloadTranslatedQstButton" class="hidden">–°–∫–∞—á–∞—Ç—å (qst)</button>
                     <button id="continueLaterButton" class="hidden" data-lang-key="continue_later_button">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–∑–∂–µ</button>
                     <button id="finishTestButton" class="finish-test-early hidden" data-lang-key="finish_early_button">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç</button>
                </div>
            </div>

            <div id="resultsArea" class="hidden">
                <h2 data-lang-key="quiz_finished_title">–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!</h2>
                <p><span data-lang-key="your_result">–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</span> <span id="finalCorrect"></span> <span data-lang-key="of_label">–∏–∑</span> <span id="finalTotal"></span>.</p>
                <p><span data-lang-key="accuracy_label">–¢–æ—á–Ω–æ—Å—Ç—å:</span> <span id="finalPercentage"></span>%</p>
                <div id="feedbackDownloadArea" class="hidden">
                    <button id="downloadErrorsButton" data-lang-key="download_errors_button">–°–∫–∞—á–∞—Ç—å –Ω–µ–æ—Ç–≤–µ—á–µ–Ω–Ω—ã–µ/–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã</button>
                </div>
                <div id="errorReviewArea" class="hidden">
                     <button id="reviewErrorsButton" data-lang-key="review_errors_button">–†–∞–±–æ—Ç–∞ –Ω–∞–¥ –æ—à–∏–±–∫–∞–º–∏</button>
                </div>
                <div id="triggeredQuizDownloadArea" class="hidden">
                    <button id="downloadTriggeredQuizButton" data-lang-key="download_triggered_quiz_button">–°–∫–∞—á–∞—Ç—å —Ç–µ—Å—Ç —Å —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏</button>
                </div>
                <button id="restartButton" data-lang-key="restart_button">–ü—Ä–æ–π—Ç–∏ –¥—Ä—É–≥–æ–π —Ç–µ—Å—Ç</button>
            </div>

            <div id="parserArea" class="hidden">
                <!-- ================= –ù–û–í–´–ô –ë–õ–û–ö: –í–ö–õ–ê–î–ö–ò ================= -->
                <div class="parser-tabs">
                    <button id="converterTabBtn" class="parser-tab active" data-lang-key="tab_converter">–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –∏–∑ —Ç–µ–∫—Å—Ç–∞</button>
                    <button id="aiGeneratorTabBtn" class="parser-tab" data-lang-key="tab_ai_generator">–ò–ò-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–æ —Ç–µ–º–µ</button>
                </div>

                <!-- ================= –ù–û–í–´–ô –ë–õ–û–ö: –ö–û–ù–¢–ï–ù–¢ –î–õ–Ø –í–ö–õ–ê–î–û–ö ================= -->
                <div class="parser-tab-content-wrapper">

                    <!-- ========= –í–ö–õ–ê–î–ö–ê 1: –ö–û–ù–í–ï–†–¢–ï–† (—Å—Ç–∞—Ä—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª) ========= -->
                    <div id="converterContent" class="parser-tab-content active">
                        <p style="text-align: center; color: var(--secondary-text-color);" data-lang-key="parser_description">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –∏–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç —Ç–µ—Å—Ç–∞.</p>
                        
                        <div class="settings-group">
                            <div class="parser-label-container">
                                <label for="parserFileInput" data-lang-key="parser_upload_or_paste">1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª (.txt) –∏–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –Ω–∏–∂–µ:</label>
                                <button id="clearParserInputBtn" class="btn-secondary-small" data-lang-key="clear_parser_input">–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª–µ</button>
                            </div>
                            <input type="file" id="parserFileInput" accept=".txt">
                            <textarea id="parserInput" rows="10" placeholder="–ò–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ —Ç–µ–∫—Å—Ç –∏–∑ –≤–∞—à–µ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞..." data-lang-key="parser_input_placeholder"></textarea>
                        </div>
                        <div class="settings-group">
                            <label for="parserPatternSelect" data-lang-key="parser_select_format">2. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç (–∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –¥–ª—è –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è):</label>
                            <select id="parserPatternSelect" style="width: 100%; padding: 8px; border-radius: 4px;">
                                <option value="auto" selected>-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ --</option>
                            </select>
                        </div>
                        <div class="settings-group" style="text-align: center;">
                            <button id="runParserBtn" data-lang-key="parser_run_button">3. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        </div>
                        
                        <p style="text-align: center; margin: 15px 0; color: var(--secondary-text-color);" data-lang-key="or_divider">-- –∏–ª–∏ --</p>
                        
                        <h4 data-lang-key="ai_from_text_title">ü§ñ –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç –∏–∑ –≤–∞—à–µ–≥–æ —Ç–µ–∫—Å—Ç–∞ (–ò–ò)</h4>

                        <div class="settings-group">
                            <label for="aiQuestionCount" data-lang-key="ai_question_count_label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –ò–ò:</label>
                            <div style="display: flex; gap: 10px; align-items: center; margin-top: 10px;">
                                <input type="number" id="aiQuestionCount" min="1" value="5" class="range-input" style="width: 80px;">
                                <input type="checkbox" id="aiAutoCount" style="margin-left: 15px;">
                                <label for="aiAutoCount" data-lang-key="ai_auto_mode_label">–ê–≤—Ç–æ</label>
                            </div>
                        </div>

                        <div class="settings-group">
                            <label for="aiAnswerCount" data-lang-key="ai_answer_count_label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞:</label>
                            <select id="aiAnswerCount" style="width: 100%; padding: 8px; border-radius: 4px; margin-top: 10px;">
                                <option value="3">3</option>
                                <option value="4" selected>4 (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                            </select>
                        </div>

                        <div class="settings-group">
                            <div style="display: flex; gap: 10px; align-items: center; margin-top: 10px;">
                                <input type="checkbox" id="aiAutoCategory" checked>
                                <label for="aiAutoCategory" data-lang-key="ai_auto_category_label">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</label>
                            </div>
                        </div>
                        
                        <div class="settings-group" style="text-align: center;">
                            <button id="generateTestFromTextBtn">
                               <span data-lang-key="ai_generate_from_text_button">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç –∏–∑ —Ç–µ–∫—Å—Ç–∞</span>
                            </button>
                        </div>
                    </div>



                    <!-- ========= –í–ö–õ–ê–î–ö–ê 2: –ò–ò-–ì–ï–ù–ï–†–ê–¢–û–† (–Ω–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª) ========= -->
                    <div id="aiGeneratorContent" class="parser-tab-content">
                        <p style="text-align: center; color: var(--secondary-text-color);" data-lang-key="ai_topic_description">–ò–ò —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Å–æ–∑–¥–∞—Å—Ç —Ç–µ—Å—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ —É–∫–∞–∑–∞–Ω–Ω–æ–π —Ç–µ–º—ã, –∏—Å–ø–æ–ª—å–∑—É—è —Å–≤–æ–∏ –∑–Ω–∞–Ω–∏—è.</p>
                        
                        <div class="settings-group">
                             <label for="aiTopicInput" data-lang-key="ai_topic_label">1. –í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–∞:</label>
                             <textarea id="aiTopicInput" rows="4" placeholder="–ü—Ä–∏–º–µ—Ä: –ò—Å—Ç–æ—Ä–∏—è –î—Ä–µ–≤–Ω–µ–≥–æ –†–∏–º–∞ –≤ –ø–µ—Ä–∏–æ–¥ –†–µ—Å–ø—É–±–ª–∏–∫–∏, 15 –≤–æ–ø—Ä–æ—Å–æ–≤, 4 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ—Ç–≤–µ—Ç–∞, —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –ø–æ –≤–æ–π–Ω–∞–º..." data-lang-key="ai_topic_placeholder"></textarea>
                        </div>

                        <div class="settings-group">
                            <label for="aiTopicQuestionCount" data-lang-key="ai_topic_question_count_label">2. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤ (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ –≤ —Ç–µ–º–µ):</label>
                            <input type="number" id="aiTopicQuestionCount" min="1" max="50" value="10" class="range-input" style="width: 80px;">
                        </div>

                        <div class="settings-group">
                            <label for="aiTopicAnswerCount" data-lang-key="ai_topic_answer_count_label">3. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞ (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ –≤ —Ç–µ–º–µ):</label>
                             <select id="aiTopicAnswerCount" style="width: 100%; padding: 8px; border-radius: 4px; margin-top: 10px;">
                                <option value="3">3</option>
                                <option value="4" selected>4 (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                            </select>
                        </div>
                        
                        <div class="settings-group">
                             <div style="display: flex; gap: 10px; align-items: center; margin-top: 10px;">
                                <input type="checkbox" id="aiTopicAutoCategory" checked>
                                <label for="aiTopicAutoCategory" data-lang-key="ai_topic_auto_category_label">4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</label>
                            </div>
                        </div>

                        <!-- ================= –í–û–¢ –û–ù–ê, –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ù–ê–Ø –ö–ù–û–ü–ö–ê ================= -->
                         <div class="settings-group" style="text-align: center;">
                            <button id="generateTestFromTopicBtn">
                                <span data-lang-key="ai_generate_from_topic_button">ü§ñ –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç –ø–æ —Ç–µ–º–µ (–ò–ò)</span>
                            </button>
                        </div>
                        <!-- ==================================================================== -->
                    </div>
                    
                </div>

                <!-- ================= –û–ë–©–ò–ï –≠–õ–ï–ú–ï–ù–¢–´ (—Ä–µ–∑—É–ª—å—Ç–∞—Ç, –æ—à–∏–±–∫–∏, –∫–Ω–æ–ø–∫–∏) ================= -->
                <div id="parserErrorsArea" class="hidden">
                    <button id="showErrorsBtn">
                        <span data-lang-key="parser_errors_found">‚ö†Ô∏è –û—à–∏–±–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</span> (<span id="errorCount">0</span>)
                    </button>
                    <ul id="errorList"></ul>
                </div>
                <div id="parserOutputArea" class="hidden">
                    <hr>
                    <h3 data-lang-key="parser_result_title">–†–µ–∑—É–ª—å—Ç–∞—Ç:</h3>
                    
                    <div class="filter-controls-container">
                        <button id="filterVariantsBtn">‚öôÔ∏è –§–∏–ª—å—Ç—Ä –ø–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º</button>
                        <div id="filterVariantsDropdown" class="filter-dropdown hidden">
                            <div class="filter-dropdown-header">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª-–≤–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:</div>
                            <div id="filterVariantCheckboxes" class="filter-checkboxes">
                                <!-- –ß–µ–∫–±–æ–∫—Å—ã –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç–æ–º -->
                            </div>
                            <div class="filter-actions">
                                <button id="applyVariantFilterBtn">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                                <button id="resetVariantFilterBtn" class="btn-secondary-small">–°–±—Ä–æ—Å</button>
                            </div>
                        </div>
                    </div>
                    
                    <textarea id="parserOutput" rows="10"></textarea>
                    <button id="downloadParsedBtn" data-lang-key="download_parsed_button">–°–∫–∞—á–∞—Ç—å .qst —Ñ–∞–π–ª</button>
                </div>
                <button id="backToMainFromParserBtn" style="margin-top: 15px; background-color: var(--button-secondary-bg);" data-lang-key="back_button">–ù–∞–∑–∞–¥</button>
            </div>

        </div>   

        <footer>
            <p>prod by @iverrum</p>
        </footer>
        
        <audio id="notificationSound" src="https://notificationsounds.com/storage/sounds/file-sounds-1150-pristine.mp3" preload="auto"></audio>

    </div> 
    
    <div id="testResultsModal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 600px;">
            <h3 id="testResultsModalTitle" data-lang-key="results_modal_title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ —Ç–µ—Å—Ç—É</h3>
            <div id="testResultsTableContainer" style="max-height: 400px; overflow-y: auto; margin-top: 20px;">
                <!-- –¢–∞–±–ª–∏—Ü–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –±—É–¥–µ—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω–∞ —Å—é–¥–∞ -->
            </div>
            <div class="modal-buttons">
                <button onclick="ChatModule.closeModal('testResultsModal')" data-lang-key="auth_close_button">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- === –ù–ê–ß–ê–õ–û –ù–û–í–û–ì–û –ö–û–î–ê: –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –û–ë–™–Ø–°–ù–ï–ù–ò–ô === -->
    <div id="aiExplanationModal" class="modal-overlay hidden">
        <div class="modal-content" style="text-align: left;">
            
            <!-- === –ù–ê–ß–ê–õ–û –ò–ó–ú–ï–ù–ï–ù–ò–ô === -->
            <div class="parser-label-container" style="margin-bottom: 10px;">
                <h3 data-lang-key="ai_explanation_title">üí° –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –æ—Ç –ò–ò</h3>
                <button id="aiExplanationTranslateBtn" class="btn-secondary-small hidden" data-lang-key="ai_toggle_translation_button">
                    –û—Ä–∏–≥–∏–Ω–∞–ª/–ü–µ—Ä–µ–≤–æ–¥
                </button>
            </div>



            <div id="aiExplanationQuestion" style="background: var(--input-bg-color); padding: 10px; border-radius: 5px; margin-bottom: 10px;"></div>
            <div class="settings-group" style="border: none; padding: 0; margin-bottom: 15px;">
                <label data-lang-key="ai_explanation_style_label">–°—Ç–∏–ª—å –æ–±—ä—è—Å–Ω–µ–Ω–∏—è:</label>

                
                <div id="aiExplanationStyleDropdown" class="style-dropdown">
                    <!-- –≠—Ç–æ –≥–ª–∞–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –≤—Å–µ–≥–¥–∞ –≤–∏–¥–Ω–∞ -->
                    <button id="aiExplanationStyleButton" class="style-dropdown-btn">
                        <span id="aiExplanationStyleText">–ü—Ä–æ—Å—Ç–æ</span>
                        <span class="dropdown-arrow">‚ñº</span>
                    </button>
                    <!-- –≠—Ç–æ —Å–∫—Ä—ã—Ç–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–ø–∏—Å–∫–∞ -->
                    <div id="aiExplanationStyleContent" class="style-dropdown-content hidden">
                        <a href="#" data-style="simple" data-lang-key="ai_style_simple">–ü—Ä–æ—Å—Ç–æ</a>
                        <a href="#" data-style="scientific" data-lang-key="ai_style_scientific">–ù–∞—É—á–Ω–æ</a>
                        <a href="#" data-style="associative" data-lang-key="ai_style_associative">–ê–Ω–∞–ª–æ–≥–∏—è</a>
                        <a href="#" data-style="stepbystep" data-lang-key="ai_style_stepbystep">–ü–æ—à–∞–≥–æ–≤–æ</a>
                        <a href="#" data-style="practical" data-lang-key="ai_style_practical">–ü—Ä–∞–∫—Ç–∏—á–Ω–æ</a>
                        <a href="#" data-style="visual" data-lang-key="ai_style_visual">–ù–∞–≥–ª—è–¥–Ω–æ</a>
                    </div>
                </div>


            </div>
            <div id="aiExplanationOutput">
                <!-- –°—é–¥–∞ –±—É–¥–µ—Ç –≤—Å—Ç–∞–≤–ª—è—Ç—å—Å—è –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –∏–ª–∏ —Å–ø–∏–Ω–Ω–µ—Ä -->
            </div>
            <div class="modal-buttons" style="justify-content: space-between; margin-top: 20px;">
                            <!-- –ù–û–í–ê–Ø –ö–ù–û–ü–ö–ê -->
                            <button id="copyExplanationBtn" data-lang-key="copy_button">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                            
                            <button onclick="ChatModule.closeModal('aiExplanationModal')" data-lang-key="auth_close_button">–ó–∞–∫—Ä—ã—Ç—å</button>
                        </div>
        </div>
    </div>

    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <script src="script.js"></script>    
    <!-- === –ù–ê–ß–ê–õ–û –ù–û–í–û–ì–û –ö–û–î–ê: –£–í–ï–î–û–ú–õ–ï–ù–ò–ï –û –í–´–•–û–î–ï === -->
    <div id="exitToast" class="exit-toast hidden" data-lang-key="exit_toast_text">
        –ù–∞–∂–º–∏—Ç–µ –µ—â–µ —Ä–∞–∑ –¥–ª—è –≤—ã—Ö–æ–¥–∞
    </div>
    <!-- === –ö–û–ù–ï–¶ –ù–û–í–û–ì–û –ö–û–î–ê === -->


</body>
</html>


